<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Diligent::ScreenSpaceAmbientOcclusion Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d2/dfd/classDiligent_1_1ScreenSpaceAmbientOcclusion.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="../../d6/d9a/classDiligent_1_1ScreenSpaceAmbientOcclusion-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Diligent::ScreenSpaceAmbientOcclusion Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements <a href="https://github.com/DiligentGraphics/DiligentFX/tree/master/PostProcess/ScreenSpaceAmbientOcclusion">screen-space ambient occlusion post-process effect</a>.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;ScreenSpaceAmbientOcclusion.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d23/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1CreateInfo.html">CreateInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create info.  <a href="../../d4/d23/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1CreateInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html">RenderAttributes</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Render attributes.  <a href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a7ff220a55362d3778487d34992df2d5f" id="r_a7ff220a55362d3778487d34992df2d5f"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7ff220a55362d3778487d34992df2d5f">FEATURE_FLAGS</a> : Uint32 { <a class="el" href="#a7ff220a55362d3778487d34992df2d5fad95034a04d9d62ae492b13099dafc4b1">FEATURE_FLAG_NONE</a> = 0u
, <a class="el" href="#a7ff220a55362d3778487d34992df2d5fa2572b81fd0be014b9e355e20bcd1b829">FEATURE_FLAG_HALF_PRECISION_DEPTH</a> = 1u &lt;&lt; 0u
, <a class="el" href="#a7ff220a55362d3778487d34992df2d5faa3a3951fd1c3225b45b4c455c0a2720c">FEATURE_FLAG_HALF_RESOLUTION</a> = 1u &lt;&lt; 1u
, <a class="el" href="#a7ff220a55362d3778487d34992df2d5fa88b6cea5de4d14e4455e4bd95002ac26">FEATURE_FLAG_UNIFORM_WEIGHTING</a> = 1u &lt;&lt; 2u
 }</td></tr>
<tr class="memdesc:a7ff220a55362d3778487d34992df2d5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Feature flags that control the behavior of the effect.  <a href="#a7ff220a55362d3778487d34992df2d5f">More...</a><br /></td></tr>
<tr class="separator:a7ff220a55362d3778487d34992df2d5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a93630b611e27e4449d677270c9d2030a" id="r_a93630b611e27e4449d677270c9d2030a"><td class="memItemLeft" align="right" valign="top"><a id="a93630b611e27e4449d677270c9d2030a" name="a93630b611e27e4449d677270c9d2030a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>ScreenSpaceAmbientOcclusion</b> (<a class="el" href="../../de/dc2/classDiligent_1_1IRenderDevice.html">IRenderDevice</a> *pDevice, const <a class="el" href="../../d4/d23/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1CreateInfo.html">CreateInfo</a> &amp;CI)</td></tr>
<tr class="memdesc:a93630b611e27e4449d677270c9d2030a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new instance of the <a class="el" href="../../d2/dfd/classDiligent_1_1ScreenSpaceAmbientOcclusion.html" title="Implements screen-space ambient occlusion post-process effect.">ScreenSpaceAmbientOcclusion</a> class. <br /></td></tr>
<tr class="separator:a93630b611e27e4449d677270c9d2030a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a460617b66d30ea24f184e02426889b5d" id="r_a460617b66d30ea24f184e02426889b5d"><td class="memItemLeft" align="right" valign="top"><a id="a460617b66d30ea24f184e02426889b5d" name="a460617b66d30ea24f184e02426889b5d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>PrepareResources</b> (<a class="el" href="../../de/dc2/classDiligent_1_1IRenderDevice.html">IRenderDevice</a> *pDevice, <a class="el" href="../../d9/dcf/classDiligent_1_1IDeviceContext.html">IDeviceContext</a> *pDeviceContext, PostFXContext *pPostFXContext, <a class="el" href="#a7ff220a55362d3778487d34992df2d5f">FEATURE_FLAGS</a> FeatureFlags)</td></tr>
<tr class="memdesc:a460617b66d30ea24f184e02426889b5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepares the effect for rendering. <br /></td></tr>
<tr class="separator:a460617b66d30ea24f184e02426889b5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac05cc013b24b5a905fe32da289466a9" id="r_aac05cc013b24b5a905fe32da289466a9"><td class="memItemLeft" align="right" valign="top"><a id="aac05cc013b24b5a905fe32da289466a9" name="aac05cc013b24b5a905fe32da289466a9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Execute</b> (const <a class="el" href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html">RenderAttributes</a> &amp;RenderAttribs)</td></tr>
<tr class="memdesc:aac05cc013b24b5a905fe32da289466a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes the effect. <br /></td></tr>
<tr class="separator:aac05cc013b24b5a905fe32da289466a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcc99057fba28ee2cf47e8eb39e06cf3" id="r_adcc99057fba28ee2cf47e8eb39e06cf3"><td class="memItemLeft" align="right" valign="top"><a id="adcc99057fba28ee2cf47e8eb39e06cf3" name="adcc99057fba28ee2cf47e8eb39e06cf3"></a>
<a class="el" href="../../dc/d24/structDiligent_1_1ITextureView.html">ITextureView</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>GetAmbientOcclusionSRV</b> () const</td></tr>
<tr class="memdesc:adcc99057fba28ee2cf47e8eb39e06cf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the shader resource view of the occlusion texture. <br /></td></tr>
<tr class="separator:adcc99057fba28ee2cf47e8eb39e06cf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a77bd36ac3278dec9a57987a9d84d41de" id="r_a77bd36ac3278dec9a57987a9d84d41de"><td class="memItemLeft" align="right" valign="top"><a id="a77bd36ac3278dec9a57987a9d84d41de" name="a77bd36ac3278dec9a57987a9d84d41de"></a>
static bool&#160;</td><td class="memItemRight" valign="bottom"><b>UpdateUI</b> (HLSL::ScreenSpaceAmbientOcclusionAttribs &amp;SSRAttribs, <a class="el" href="#a7ff220a55362d3778487d34992df2d5f">FEATURE_FLAGS</a> &amp;FeatureFlags)</td></tr>
<tr class="memdesc:a77bd36ac3278dec9a57987a9d84d41de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds the ImGui controls to the UI. <br /></td></tr>
<tr class="separator:a77bd36ac3278dec9a57987a9d84d41de"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements <a href="https://github.com/DiligentGraphics/DiligentFX/tree/master/PostProcess/ScreenSpaceAmbientOcclusion">screen-space ambient occlusion post-process effect</a>. </p>
<h1><a class="anchor" id="autotoc_md157"></a>
Screen Space Ambient Occlusion</h1>
<p><img src="../../media/ssao-kitchen.jpg" alt="" class="inline"/></p>
<p>Kitchen scene rendered by <a href="https://github.com/DiligentGraphics/DiligentFX/tree/master/Hydrogent">Hydrogent</a> with Screen Space Ambient Occlusion effect applied.</p>
<h2><a class="anchor" id="autotoc_md158"></a>
Table of contents</h2>
<ul>
<li>Introduction</li>
<li>Integration guidelines<ul>
<li>Input resources</li>
<li>Host API</li>
</ul>
</li>
<li>Implementation details</li>
<li><a class="el" href="../../de/d6b/README.html#references">References</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md159"></a>
Introduction</h2>
<p>We needed to add screen space ambient occlusion to our project with the following requirements:</p><ul>
<li>Compatibility with WebGL</li>
<li><p class="startli">Use cosine-weighted AO and have the ability to use a large radius</p>
<p class="startli">We used Intel's implementation of Screen Space Occlusion as the basis for our implementation <a href="https://github.com/GameTechDev/XeGTAO"><b>[Intel-XeGTAO]</b></a></p>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md160"></a>
Integration guidelines</h2>
<h3><a class="anchor" id="autotoc_md161"></a>
Input resources</h3>
<p>The following table enumerates all external inputs required by SSAO.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Name</b>   </th><th class="markdownTableHeadNone"><b>Format</b>   </th><th class="markdownTableHeadNone"><b>Notes</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Depth buffer   </td><td class="markdownTableBodyNone"><code>APPLICATION SPECIFIED (1x FLOAT)</code>   </td><td class="markdownTableBodyNone">The depth buffer for the current frame provided by the application. The data should be provided as a single floating point value, the precision of which is under the application's control.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Normal buffer   </td><td class="markdownTableBodyNone"><code>APPLICATION SPECIFIED (3x FLOAT)</code>   </td><td class="markdownTableBodyNone">The normal buffer for the current frame provided by the application in the [-1.0, +1.0] range. Normals should be in world space.   </td></tr>
</table>
<p>The effect uses a number of parameters to control the quality and performance of the effect organized into the <code>HLSL::ScreenSpaceAmbientOcclusionAttribs</code> structure. The following table lists the parameters and their descriptions.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Name</b>   </th><th class="markdownTableHeadNone"><b>Notes</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Effect radius   </td><td class="markdownTableBodyNone">World-space ambient occlusion radius.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Effect falloff range   </td><td class="markdownTableBodyNone">Gently reduces sample impact as it gets out of the 'Effect radius' bounds.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Radius multiplier   </td><td class="markdownTableBodyNone">Use different value as compared to the ground truth radius to counter inherent screen space biases.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Depth MIP sampling offset   </td><td class="markdownTableBodyNone">Controls the main trade-off between performance (memory bandwidth) and quality (temporal stability is the first affected, thin objects next).    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Temporal stability factor   </td><td class="markdownTableBodyNone">The value is responsible for interpolating between the current and previous frame.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Spatial reconstruction radius   </td><td class="markdownTableBodyNone">Controls the kernel size in the spatial reconstruction step. Increasing the value increases the deviation from the ground truth but reduces the noise.   </td></tr>
</table>
<p>The effect can be configured using the <code><a class="el" href="#a7ff220a55362d3778487d34992df2d5f" title="Feature flags that control the behavior of the effect.">ScreenSpaceAmbientOcclusion::FEATURE_FLAGS</a></code> enumeration. The following table lists the flags and their descriptions.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Name</b>   </th><th class="markdownTableHeadNone"><b>Notes</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>FEATURE_FLAG_HALF_PRECISION_DEPTH</code>   </td><td class="markdownTableBodyNone">Use half-precision fixed-point format for depth values in the SSAO computation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>FEATURE_FLAG_HALF_RESOLUTION</code>   </td><td class="markdownTableBodyNone">Compute SSAO at half resolution of the target render texture    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>FEATURE_FLAG_UNIFORM_WEIGHTING</code>   </td><td class="markdownTableBodyNone">By default, we compute AO using the GTAO algorithm. This flag enables the computation of AO using the HBAO algorithm   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md162"></a>
Host API</h3>
<p>To integrate SSAO into your project, include the following necessary header files: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;PostFXContext.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d47/ScreenSpaceAmbientOcclusion_8hpp.html">ScreenSpaceAmbientOcclusion.hpp</a>&quot;</span></div>
<div class="ttc" id="aScreenSpaceAmbientOcclusion_8hpp_html"><div class="ttname"><a href="../../dd/d47/ScreenSpaceAmbientOcclusion_8hpp.html">ScreenSpaceAmbientOcclusion.hpp</a></div></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">namespace </span>HLSL</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#include &quot;Shaders/Common/public/BasicStructures.fxh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Shaders/PostProcess/ScreenSpaceAmbientOcclusion/public/ScreenSpaceAmbientOcclusionStructures.fxh&quot;</span></div>
<div class="line">} <span class="comment">// namespace HLSL</span></div>
</div><!-- fragment --><p>Now, create the necessary objects: </p><div class="fragment"><div class="line">m_PostFXContext = std::make_unique&lt;PostFXContext&gt;(m_pDevice);</div>
<div class="line">m_SSAO          = std::make_unique&lt;ScreenSpaceAmbientOcclusion&gt;(m_pDevice);</div>
</div><!-- fragment --><p>Next, call the methods to prepare resources for the <code>PostFXContext</code> and <code><a class="el" href="../../d2/dfd/classDiligent_1_1ScreenSpaceAmbientOcclusion.html" title="Implements screen-space ambient occlusion post-process effect.">ScreenSpaceAmbientOcclusion</a></code> objects. This needs to be done every frame before starting the rendering process. </p><div class="fragment"><div class="line">{</div>
<div class="line">    PostFXContext::FrameDesc FrameDesc;</div>
<div class="line">    FrameDesc.Index  = m_CurrentFrameNumber; <span class="comment">// Current frame number.</span></div>
<div class="line">    FrameDesc.Width  = SCDesc.Width;         <span class="comment">// Current screen width.</span></div>
<div class="line">    FrameDesc.Height = SCDesc.Height;        <span class="comment">// Current screen height.</span></div>
<div class="line">    m_PostFXContext-&gt;PrepareResources(m_pDevice, FrameDesc, PostFXContext::FEATURE_FLAG_NONE);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_enumeration" href="#a7ff220a55362d3778487d34992df2d5f">ScreenSpaceAmbientOcclusion::FEATURE_FLAGS</a> ActiveFeatures = ...;</div>
<div class="line">    m_ScreenSpaceAmbientOcclusion-&gt;PrepareResources(m_pDevice, m_pImmediateContext, m_PostFXContext.get(), ActiveFeatures);</div>
<div class="line">}</div>
<div class="ttc" id="aclassDiligent_1_1ScreenSpaceAmbientOcclusion_html_a7ff220a55362d3778487d34992df2d5f"><div class="ttname"><a href="#a7ff220a55362d3778487d34992df2d5f">Diligent::ScreenSpaceAmbientOcclusion::FEATURE_FLAGS</a></div><div class="ttdeci">FEATURE_FLAGS</div><div class="ttdoc">Feature flags that control the behavior of the effect.</div><div class="ttdef"><b>Definition</b> ScreenSpaceAmbientOcclusion.hpp:214</div></div>
</div><!-- fragment --><p>Now we invoke the method <code>PostFXContext::Execute</code>. At this stage, some intermediate resources necessary for all post-processing objects dependent on <code>PostFXContext</code> are calculated. This method can take a constant buffer directly containing an array from the current and previous cameras (for this method, you can refer to this section of the code [<a href="https://github.com/DiligentGraphics/DiligentSamples/blob/380b0a05b6c72d80fd6d574d7343ead77d6dd7eb/Tutorials/Tutorial27_PostProcessing/src/Tutorial27_PostProcessing.cpp#L164">0</a>] and [<a href="https://github.com/DiligentGraphics/DiligentSamples/blob/380b0a05b6c72d80fd6d574d7343ead77d6dd7eb/Tutorials/Tutorial27_PostProcessing/src/Tutorial27_PostProcessing.cpp#L228">1</a>]). Alternatively, you can pass the corresponding pointers <code>const HLSL::CameraAttribs* pCurrCamera</code> and <code>const HLSL::CameraAttribs* pPrevCamera</code> for the current and previous cameras, respectively. You also need to pass the depth of the current and previous frames (the depth buffers should not contain transparent objects), and a buffer with motion vectors in NDC space, into the corresponding <code>ITextureView* pCurrDepthBufferSRV</code>, <code>ITextureView* pPrevDepthBufferSRV</code>, <code>ITextureView* pMotionVectorsSRV</code> pointers.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    PostFXContext::RenderAttributes PostFXAttibs;</div>
<div class="line">    PostFXAttibs.pDevice             = m_pDevice;</div>
<div class="line">    PostFXAttibs.pDeviceContext      = m_pImmediateContext;</div>
<div class="line">    PostFXAttibs.pCameraAttribsCB    = m_FrameAttribsCB;  <span class="comment">// m_Resources[RESOURCE_IDENTIFIER_CAMERA_CONSTANT_BUFFER].AsBuffer();</span></div>
<div class="line">    PostFXAttibs.pCurrDepthBufferSRV = m_CurrDepthBuffer; <span class="comment">// m_Resources[RESOURCE_IDENTIFIER_DEPTH0 + CurrFrameIdx].GetTextureSRV();</span></div>
<div class="line">    PostFXAttibs.pPrevDepthBufferSRV = m_PrevDepthBuffer; <span class="comment">// m_Resources[RESOURCE_IDENTIFIER_DEPTH0 + PrevFrameIdx].GetTextureSRV();</span></div>
<div class="line">    PostFXAttibs.pMotionVectorsSRV   = m_MotionBuffer;    <span class="comment">// m_GBuffer-&gt;GetBuffer(GBUFFER_RT_MOTION_VECTORS)-&gt;GetDefaultView(TEXTURE_VIEW_SHADER_RESOURCE);</span></div>
<div class="line">    m_PostFXContext-&gt;Execute(PostFXAttibs);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now we need to directly invoke calculation of SSAO. To do this, we call the <code><a class="el" href="#aac05cc013b24b5a905fe32da289466a9" title="Executes the effect.">ScreenSpaceAmbientOcclusion::Execute</a></code> method. Before this, we need to fill the passed structures <code>ScreenSpaceAmbientOcclusionAttribs</code> and <code><a class="el" href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html" title="Render attributes.">ScreenSpaceAmbientOcclusion::RenderAttributes</a></code> with the necessary data. Refer to the Input resources section for parameter description. </p><div class="fragment"><div class="line">{</div>
<div class="line">    HLSL::ScreenSpaceAmbientOcclusionAttribs SSAOSettings{};</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_struct" href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html">ScreenSpaceAmbientOcclusion::RenderAttributes</a> SSAORenderAttribs{};</div>
<div class="line">    SSAORenderAttribs.<a class="code hl_variable" href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html#a3c0188622e78599e02f2e27ce6a68877">pDevice</a>          = m_pDevice;</div>
<div class="line">    SSAORenderAttribs.pDeviceContext   = m_pImmediateContext;</div>
<div class="line">    SSAORenderAttribs.pPostFXContext   = m_PostFXContext.get();</div>
<div class="line">    SSAORenderAttribs.pDepthBufferSRV  = m_CurrDepthBuffer; <span class="comment">// m_Resources[RESOURCE_IDENTIFIER_DEPTH0 + CurrFrameIdx].GetTextureSRV();</span></div>
<div class="line">    SSAORenderAttribs.pNormalBufferSRV = m_NormalBuffer;    <span class="comment">// m_GBuffer-&gt;GetBuffer(GBUFFER_RT_NORMAL)-&gt;GetDefaultView(TEXTURE_VIEW_SHADER_RESOURCE);</span></div>
<div class="line">    SSAORenderAttribs.pSSAOAttribs     = &amp;SSAOSettings;</div>
<div class="line">    m_SSAO-&gt;Execute(SSAORenderAttribs);</div>
<div class="line">}</div>
<div class="ttc" id="astructDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes_html"><div class="ttname"><a href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html">Diligent::ScreenSpaceAmbientOcclusion::RenderAttributes</a></div><div class="ttdoc">Render attributes.</div><div class="ttdef"><b>Definition</b> ScreenSpaceAmbientOcclusion.hpp:230</div></div>
<div class="ttc" id="astructDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes_html_a3c0188622e78599e02f2e27ce6a68877"><div class="ttname"><a href="../../d9/de7/structDiligent_1_1ScreenSpaceAmbientOcclusion_1_1RenderAttributes.html#a3c0188622e78599e02f2e27ce6a68877">Diligent::ScreenSpaceAmbientOcclusion::RenderAttributes::pDevice</a></div><div class="ttdeci">IRenderDevice * pDevice</div><div class="ttdoc">Render device that may be used to create new objects needed for this frame, if any.</div><div class="ttdef"><b>Definition</b> ScreenSpaceAmbientOcclusion.hpp:232</div></div>
</div><!-- fragment --><p>Now, you can directly obtain a <code><a class="el" href="../../dc/d24/structDiligent_1_1ITextureView.html" title="Texture view interface.">ITextureView</a></code> on the texture containing the SSAO result using the method <code><a class="el" href="#adcc99057fba28ee2cf47e8eb39e06cf3" title="Returns the shader resource view of the occlusion texture.">ScreenSpaceAmbientOcclusion::GetAmbientOcclusionSRV</a></code>. After this, you can apply SSAO in your rendering pipeline using the formula below.</p>
<div class="fragment"><div class="line">\large \text{DiffuseRadiance} = \sum_{i=1}^{n} (1 - F) \times \text{Diffuse} \times \text{SSAO} \times \text{IrradianceMap}_i</div>
</div><!-- fragment --><p>The parameter $F$ is the Fresnel Schlick coefficient. You can use the approximation <code>FresnelSchlickWithRoughness</code> from this article <a href="https://seblagarde.wordpress.com/2011/08/17/hello-world/"><b>[SÃ©bastien Lagarde, Adopting a physically based shading model]</b></a></p>
<h2><a class="anchor" id="autotoc_md163"></a>
Implementation details</h2>
<p>As we mentioned earlier, we use the <a href="https://github.com/GameTechDev/XeGTAO"><b>[Intel-XeGTAO]</b></a> implementation as a starting point for our algorithm. For a deeper understanding of the context and nuances involved, it is recommended to review the documentation available in the implementation's repository.</p>
<p>Modifications made from the original algorithm version include:</p><ul>
<li>Unfortunately, we cannot use compute shaders for calculating prefiltered mip levels of the depth map, so we use pixel shaders for convolving the depth map, thus we loose a bit in performance.</li>
<li>Currently, the computation of bent-normals is not implemented. However, we are considering incorporating this feature in future updates.</li>
<li>We have added the capability to compute Ambient Occlusion at half resolution. This is achieved by downsampling the depth buffer using a checkerboard pattern, effectively reducing it by half. For additional details on this process, the <a href="https://eleni.mutantstargoat.com/hikiko/depth-aware-upsampling-2/"><b>[DAW-Upsampling]</b></a> technique provides comprehensive insights.</li>
<li>The denoiser from XeGTAO is ineffective with larger AO radii, necessitating the development of a more sophisticated denoiser based on the ReBLUR algorithm. To grasp a better understanding of the underlying principles and our approach, reviewing related presentations is advised <a href="https://developer.download.nvidia.com/video/gputechconf/gtc/2019/presentation/s9985-exploring-ray-traced-future-in-metro-exodus.pdf"><b>[RTAO, 2019]</b></a>, <a href="https://developer.download.nvidia.com/video/gputechconf/gtc/2020/presentations/s22699-fast-denoising-with-self-stabilizing-recurrent-blurs.pdf"><b>[ReBLUR, 2020]</b></a>, <a href="https://link.springer.com/chapter/10.1007/978-1-4842-7185-8_49#preview"><b>[ReBLUR, 2021]</b></a>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md164"></a>
References</h2>
<ul>
<li><b>[Intel-XeGTAO]</b>: An implementation of [Jimenez et al., 2016] Ground Truth Ambient Occlusion, MIT license - <a href="https://github.com/GameTechDev/XeGTAO">https://github.com/GameTechDev/XeGTAO</a></li>
<li><b>[Jimenez et al., 2016]</b>: GTAO, Practical Realtime Strategies for Accurate Indirect Occlusion, Jimenez et al., 2016 - <a href="https://blog.selfshadow.com/publications/s2016-shading-course/activision/s2016_pbs_activision_occlusion.pdf">https://blog.selfshadow.com/publications/s2016-shading-course/activision/s2016_pbs_activision_occlusion.pdf</a></li>
<li><b>[RTAO, 2019]</b>: Exploring the Ray Traced Future in 'Metro Exodus' - <a href="https://developer.download.nvidia.com/video/gputechconf/gtc/2019/presentation/s9985-exploring-ray-traced-future-in-metro-exodus.pdf">https://developer.download.nvidia.com/video/gputechconf/gtc/2019/presentation/s9985-exploring-ray-traced-future-in-metro-exodus.pdf</a></li>
<li><b>[ReBLUR, 2020]</b>: Fast Denoising with Self Stabilizing Recurrent Blurs - <a href="https://developer.download.nvidia.com/video/gputechconf/gtc/2020/presentations/s22699-fast-denoising-with-self-stabilizing-recurrent-blurs.pdf">https://developer.download.nvidia.com/video/gputechconf/gtc/2020/presentations/s22699-fast-denoising-with-self-stabilizing-recurrent-blurs.pdf</a></li>
<li><b>[ReBLUR, 2021]</b>: ReBLUR: A Hierarchical Recurrent Denoiser - <a href="https://link.springer.com/chapter/10.1007/978-1-4842-7185-8_49#preview">https://link.springer.com/chapter/10.1007/978-1-4842-7185-8_49#preview</a></li>
<li><b>[DAW-Upsampling]</b>: Depth-aware upsampling experiments, Eleni Maria Stea - <a href="https://eleni.mutantstargoat.com/hikiko/depth-aware-upsampling-2/">https://eleni.mutantstargoat.com/hikiko/depth-aware-upsampling-2/</a>   </li>
</ul>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="a7ff220a55362d3778487d34992df2d5f" name="a7ff220a55362d3778487d34992df2d5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ff220a55362d3778487d34992df2d5f">&#9670;&#160;</a></span>FEATURE_FLAGS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="#a7ff220a55362d3778487d34992df2d5f">Diligent::ScreenSpaceAmbientOcclusion::FEATURE_FLAGS</a> : <a class="el" href="../../d7/dca/namespaceDiligent.html#a9e27ac38f8dccaa4b4f8e967cd1e868e">Uint32</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Feature flags that control the behavior of the effect. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a7ff220a55362d3778487d34992df2d5fad95034a04d9d62ae492b13099dafc4b1" name="a7ff220a55362d3778487d34992df2d5fad95034a04d9d62ae492b13099dafc4b1"></a>FEATURE_FLAG_NONE&#160;</td><td class="fielddoc"><p>No feature flags are set. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7ff220a55362d3778487d34992df2d5fa2572b81fd0be014b9e355e20bcd1b829" name="a7ff220a55362d3778487d34992df2d5fa2572b81fd0be014b9e355e20bcd1b829"></a>FEATURE_FLAG_HALF_PRECISION_DEPTH&#160;</td><td class="fielddoc"><p>Use half-precision depth buffer. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7ff220a55362d3778487d34992df2d5faa3a3951fd1c3225b45b4c455c0a2720c" name="a7ff220a55362d3778487d34992df2d5faa3a3951fd1c3225b45b4c455c0a2720c"></a>FEATURE_FLAG_HALF_RESOLUTION&#160;</td><td class="fielddoc"><p>Compute the effect in half resolution. </p>
</td></tr>
<tr><td class="fieldname"><a id="a7ff220a55362d3778487d34992df2d5fa88b6cea5de4d14e4455e4bd95002ac26" name="a7ff220a55362d3778487d34992df2d5fa88b6cea5de4d14e4455e4bd95002ac26"></a>FEATURE_FLAG_UNIFORM_WEIGHTING&#160;</td><td class="fielddoc"><p>Use uniform weighting for the occlusion. </p>
</td></tr>
</table>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d7/dca/namespaceDiligent.html">Diligent</a></li><li class="navelem"><a class="el" href="../../d2/dfd/classDiligent_1_1ScreenSpaceAmbientOcclusion.html">ScreenSpaceAmbientOcclusion</a></li>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
