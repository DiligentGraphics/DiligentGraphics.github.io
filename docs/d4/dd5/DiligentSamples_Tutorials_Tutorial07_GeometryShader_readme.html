<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Tutorial07 - Geometry Shader</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d4/dd5/DiligentSamples_Tutorials_Tutorial07_GeometryShader_readme.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial07 - Geometry Shader</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial is based on Tutorial03 and shows how to use geometry shader to render smooth wireframe.</p>
<p><img src="https://github.com/DiligentGraphics/DiligentSamples/raw/master/Tutorials/Tutorial07_GeometryShader/Animation_Large.gif" alt="" class="inline"/></p>
<p>Geometry shader is a programmable stage that resides between vertex and pixel shaders (it can also be used with hardware tessellation, in which case it resides between domain shader and pixel shader). While vertex shader processes individual vertices and pixel shader handles pixels, geometry shader operates on full primitives.</p>
<h2><a class="anchor" id="autotoc_md314"></a>
Shaders</h2>
<p>Vertex shader in this tutorial is mostly identical to that of Tutorial03. The only difference is that the shader uses <code>#include</code> directive to include <code>structures.h</code> containing the definitions of common structures.</p>
<p>Geometry shader processes entire triangles. It fist computes the triangle area which it then uses to determine the distance from every vertex to the opposite edge. The distances are then interpolated across the triangle surface by the rasterizaer allowing the pixel shader to compute the distance to the closest edge. Outputs from the vertex shader are passed through to the pixel shader without changes.</p>
<div class="fragment"><div class="line">[maxvertexcount(3)]</div>
<div class="line">void main(triangle VSOutput In[3], </div>
<div class="line">          inout TriangleStream&lt;GSOutput&gt; triStream )</div>
<div class="line">{</div>
<div class="line">    // Compute screen-space position of every vertex</div>
<div class="line">    float2 v0 = g_Constants.ViewportSize.xy * In[0].Pos.xy / In[0].Pos.w;</div>
<div class="line">    float2 v1 = g_Constants.ViewportSize.xy * In[1].Pos.xy / In[1].Pos.w;</div>
<div class="line">    float2 v2 = g_Constants.ViewportSize.xy * In[2].Pos.xy / In[2].Pos.w;</div>
<div class="line">    float2 edge0 = v2 - v1;</div>
<div class="line">    float2 edge1 = v2 - v0;</div>
<div class="line">    float2 edge2 = v1 - v0;</div>
<div class="line">    // Compute triangle area</div>
<div class="line">    float area = abs(edge1.x*edge2.y - edge1.y * edge2.x);</div>
<div class="line"> </div>
<div class="line">    GSOutput Out;</div>
<div class="line"> </div>
<div class="line">    Out.VSOut = In[0];</div>
<div class="line">    // Distance to edge0</div>
<div class="line">    Out.DistToEdges = float3(area/length(edge0), 0.0, 0.0);</div>
<div class="line">    triStream.Append( Out );</div>
<div class="line"> </div>
<div class="line">    Out.VSOut = In[1];</div>
<div class="line">    // Distance to edge1</div>
<div class="line">    Out.DistToEdges = float3(0.0, area/length(edge1), 0.0);</div>
<div class="line">    triStream.Append( Out );</div>
<div class="line"> </div>
<div class="line">    Out.VSOut = In[2];</div>
<div class="line">    // Distance to edge2</div>
<div class="line">    Out.DistToEdges = float3(0.0, 0.0, area/length(edge2));</div>
<div class="line">    triStream.Append( Out );</div>
<div class="line">}</div>
</div><!-- fragment --><p>As it was already mentioned, fragment shader computes the distance to the closest edge and uses this value to determine the edge intensity.</p>
<div class="fragment"><div class="line">struct PSOutput</div>
<div class="line">{</div>
<div class="line">    float4 Color : SV_TARGET;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  GSOutput PSIn, </div>
<div class="line">          out PSOutput PSOut)</div>
<div class="line">{</div>
<div class="line">    float4 Color = g_Texture.Sample(g_Texture_sampler, PSIn.VSOut.UV);</div>
<div class="line">    </div>
<div class="line">    // Compute distance to the closest edge</div>
<div class="line">    float minDist = min(PSIn.DistToEdges.x, PSIn.DistToEdges.y);</div>
<div class="line">    minDist = min(minDist, PSIn.DistToEdges.z);</div>
<div class="line"> </div>
<div class="line">    float lineWidth = g_Constants.LineWidth;</div>
<div class="line">    float lineIntensity = saturate((lineWidth - minDist) / lineWidth);</div>
<div class="line"> </div>
<div class="line">    float3 EdgeColor = float3(0.0, 0.0, 0.0);</div>
<div class="line">    Color.rgb = lerp(Color.rgb, EdgeColor, lineIntensity);</div>
<div class="line"> </div>
<div class="line">    PSOut.Color = Color;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md315"></a>
Initializing the Pipeline State and Rendering</h2>
<p>Pipeline state initialization is the same as in Tutorial03, with the only difference being initialization of the geometry shader:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a geometry shader</span></div>
<div class="line">RefCntAutoPtr&lt;IShader&gt; pGS;</div>
<div class="line">{</div>
<div class="line">    CreationAttribs.Desc.ShaderType = SHADER_TYPE_GEOMETRY;</div>
<div class="line">    CreationAttribs.EntryPoint      = <span class="stringliteral">&quot;main&quot;</span>;</div>
<div class="line">    CreationAttribs.Desc.Name       = <span class="stringliteral">&quot;Cube GS&quot;</span>;</div>
<div class="line">    CreationAttribs.FilePath        = <span class="stringliteral">&quot;cube.gsh&quot;</span>;</div>
<div class="line">    pDevice-&gt;CreateShader(CreationAttribs, &amp;pGS);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">PSOCreateInfo.pVS = pVS;</div>
<div class="line">PSOCreateInfo.pGS = pGS;</div>
<div class="line">PSOCreateInfo.pPS = pPS;</div>
<div class="line">pDevice-&gt;CreateGraphicsPipelineState(PSOCreateInfo, &amp;m_pPSO);</div>
</div><!-- fragment --><p>Rendering is performed in the same way as in Tutorial03. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
