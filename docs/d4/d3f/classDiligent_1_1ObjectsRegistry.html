<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Diligent::ObjectsRegistry&lt; KeyType, StrongPtrType, KeyHasher, KeyEqual &gt; Class Template Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d4/d3f/classDiligent_1_1ObjectsRegistry.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../de/de2/classDiligent_1_1ObjectsRegistry-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Diligent::ObjectsRegistry&lt; KeyType, StrongPtrType, KeyHasher, KeyEqual &gt; Class Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;ObjectsRegistry.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af93ace625d3ceaebb33a23abb220f55b" id="r_af93ace625d3ceaebb33a23abb220f55b"><td class="memTemplParams" colspan="2">template&lt;typename CreateObjectType&gt; </td></tr>
<tr class="memitem:af93ace625d3ceaebb33a23abb220f55b"><td class="memTemplItemLeft" align="right" valign="top">StrongPtrType&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#af93ace625d3ceaebb33a23abb220f55b">Get</a> (const KeyType &amp;Key, CreateObjectType &amp;&amp;CreateObject) noexcept(false)</td></tr>
<tr class="separator:af93ace625d3ceaebb33a23abb220f55b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae55639614d84442d82aca9a503d6954c" id="r_ae55639614d84442d82aca9a503d6954c"><td class="memItemLeft" align="right" valign="top">StrongPtrType&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae55639614d84442d82aca9a503d6954c">Get</a> (const KeyType &amp;Key)</td></tr>
<tr class="separator:ae55639614d84442d82aca9a503d6954c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad775b3ce7302f3d302c56518e8f9c20f" id="r_ad775b3ce7302f3d302c56518e8f9c20f"><td class="memItemLeft" align="right" valign="top"><a id="ad775b3ce7302f3d302c56518e8f9c20f" name="ad775b3ce7302f3d302c56518e8f9c20f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Purge</b> ()</td></tr>
<tr class="memdesc:ad775b3ce7302f3d302c56518e8f9c20f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes all expired pointers from the cache. <br /></td></tr>
<tr class="separator:ad775b3ce7302f3d302c56518e8f9c20f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8a9466ff6688777924cad8ea13efc19" id="r_ad8a9466ff6688777924cad8ea13efc19"><td class="memTemplParams" colspan="2"><a id="ad8a9466ff6688777924cad8ea13efc19" name="ad8a9466ff6688777924cad8ea13efc19"></a>
template&lt;typename HandlerType&gt; </td></tr>
<tr class="memitem:ad8a9466ff6688777924cad8ea13efc19"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><b>ProcessElements</b> (HandlerType &amp;&amp;Handler)</td></tr>
<tr class="memdesc:ad8a9466ff6688777924cad8ea13efc19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes each element in the cache with the specified handler. <br /></td></tr>
<tr class="separator:ad8a9466ff6688777924cad8ea13efc19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb3a07869e8f42b3905827fa2f41df51" id="r_afb3a07869e8f42b3905827fa2f41df51"><td class="memItemLeft" align="right" valign="top"><a id="afb3a07869e8f42b3905827fa2f41df51" name="afb3a07869e8f42b3905827fa2f41df51"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Clear</b> ()</td></tr>
<tr class="memdesc:afb3a07869e8f42b3905827fa2f41df51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes all objects from the cache. <br /></td></tr>
<tr class="separator:afb3a07869e8f42b3905827fa2f41df51"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;typename KeyType, typename StrongPtrType, typename KeyHasher = std::hash&lt;KeyType&gt;, typename KeyEqual = std::equal_to&lt;KeyType&gt;&gt;<br />
class Diligent::ObjectsRegistry&lt; KeyType, StrongPtrType, KeyHasher, KeyEqual &gt;</div><p>A thread-safe and exception-safe object registry that works with std::shared_ptr or <a class="el" href="../../d9/dae/classDiligent_1_1RefCntAutoPtr.html" title="Template class that implements reference counting.">RefCntAutoPtr</a>. The registry keeps weak pointers to the objects and returns strong pointers if the requested object exits. An application should keep strong pointers to the objects to keep them alive.</p>
<p>Usage example for <a class="el" href="../../d9/dae/classDiligent_1_1RefCntAutoPtr.html" title="Template class that implements reference counting.">RefCntAutoPtr</a>: </p><pre class="fragment">ObjectsRegistry&lt;std::string, RefCntAutoPtr&lt;IObject&gt;&gt; Registry;

auto pObj = Registry.Get("Key",
                         []()
                         {
                             RefCntAutoPtr&lt;IObject&gt; pObj;
                             // Create object
                             return pObj;
                         });
</pre><p>Usage example for shared_ptr: </p><pre class="fragment">struct RegistryData
{
    // ...
};
ObjectsRegistry&lt;std::string, std::shared_ptr&lt;RegistryData&gt;&gt; Registry;

auto pObj = Registry.Get("Key",
                         []()
                         {
                             return std::make_shared&lt;RegistryData&gt;();
                         });
</pre><p>If the object is not found in the registry, it is atomically created by the provided initializer function. If the object is found, the initializer function is not called.</p>
<p>It is guaranteed, that the Object will only be initialized once, even if multiple threads call <a class="el" href="#af93ace625d3ceaebb33a23abb220f55b">Get()</a> simultaneously. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ae55639614d84442d82aca9a503d6954c" name="ae55639614d84442d82aca9a503d6954c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae55639614d84442d82aca9a503d6954c">&#9670;&#160;</a></span>Get() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename KeyType, typename StrongPtrType, typename KeyHasher = std::hash&lt;KeyType&gt;, typename KeyEqual = std::equal_to&lt;KeyType&gt;&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">StrongPtrType <a class="el" href="../../d4/d3f/classDiligent_1_1ObjectsRegistry.html">Diligent::ObjectsRegistry</a>&lt; KeyType, StrongPtrType, KeyHasher, KeyEqual &gt;::Get </td>
          <td>(</td>
          <td class="paramtype">const KeyType &amp;</td>          <td class="paramname"><span class="paramname"><em>Key</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Finds the object in the registry and returns a strong pointer to it (std::shared_ptr or <a class="el" href="../../d9/dae/classDiligent_1_1RefCntAutoPtr.html" title="Template class that implements reference counting.">RefCntAutoPtr</a>). If the object is not found, returns empty pointer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Key</td><td>- The object key.</td></tr>
  </table>
  </dd>
</dl>
<p>Strong pointer to the object with the specified key, if the object is found in the registry, or empty pointer otherwise. </p>

</div>
</div>
<a id="af93ace625d3ceaebb33a23abb220f55b" name="af93ace625d3ceaebb33a23abb220f55b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af93ace625d3ceaebb33a23abb220f55b">&#9670;&#160;</a></span>Get() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename KeyType, typename StrongPtrType, typename KeyHasher = std::hash&lt;KeyType&gt;, typename KeyEqual = std::equal_to&lt;KeyType&gt;&gt; </div>
<div class="memtemplate">
template&lt;typename CreateObjectType&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">StrongPtrType <a class="el" href="../../d4/d3f/classDiligent_1_1ObjectsRegistry.html">Diligent::ObjectsRegistry</a>&lt; KeyType, StrongPtrType, KeyHasher, KeyEqual &gt;::Get </td>
          <td>(</td>
          <td class="paramtype">const KeyType &amp;</td>          <td class="paramname"><span class="paramname"><em>Key</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CreateObjectType &amp;&amp;</td>          <td class="paramname"><span class="paramname"><em>CreateObject</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Finds the object in the registry and returns strong pointer to it (std::shared_ptr or <a class="el" href="../../d9/dae/classDiligent_1_1RefCntAutoPtr.html" title="Template class that implements reference counting.">RefCntAutoPtr</a>). If the object is not found, it is atomically created using the provided initializer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Key</td><td>- The object key. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CreateObject</td><td>- Initializer function that is called if the object is not found in the registry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Strong pointer to the object with the specified key, either retrieved from the registry or initialized with the CreateObject function.</dd></dl>
<p>CreateObject function may throw in case of an error.</p>
<p>It is guaranteed, that the Object will only be initialized once, even if multiple threads call <a class="el" href="#af93ace625d3ceaebb33a23abb220f55b">Get()</a> simultaneously. However, if another thread runs an overloaded <a class="el" href="#af93ace625d3ceaebb33a23abb220f55b">Get()</a> without the initializer function with the same key, it may remove the entry from the registry, and the object will be initialized multiple times. This is OK as only one object will be added to the registry. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d7/dca/namespaceDiligent.html">Diligent</a></li><li class="navelem"><a class="el" href="../../d4/d3f/classDiligent_1_1ObjectsRegistry.html">ObjectsRegistry</a></li>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
