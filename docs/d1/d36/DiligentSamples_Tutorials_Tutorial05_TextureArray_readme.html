<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Tutorial05 - Texture Array</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d1/d36/DiligentSamples_Tutorials_Tutorial05_TextureArray_readme.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial05 - Texture Array</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial demonstrates how to combine instancing shown in Tutotial04 with texture arrays to use unique texture for every instance.</p>
<p><img src="https://github.com/DiligentGraphics/DiligentSamples/raw/master/Tutorials/Tutorial05_TextureArray/Animation_Large.gif" alt="" class="inline"/></p>
<p><a href="https://diligentgraphics.github.io/wasm-modules/Tutorial05_TextureArray/Tutorial05_TextureArray.html">â–¶ Run in the browser</a></p>
<p>Texture array is a special kind of texture that consists of multiple 2D (or 1D) textures sharing the same format, size, and the number of mip levels. Every individual texture in the array is called <em>slice</em>. Slices can be dynamically indexed by the shaders which enables a number of useful techniques such as selecting different slices for different instances.</p>
<h2><a class="anchor" id="autotoc_md304"></a>
Shaders</h2>
<p>Vertex shader is mostly similar to the one from Tutorial04, but uses one more per-instance attribute, texture array index that it passes to the pixel shader:</p>
<div class="fragment"><div class="line">struct PSInput </div>
<div class="line">{ </div>
<div class="line">    float4 Pos     : SV_POSITION; </div>
<div class="line">    float2 UV      : TEX_COORD; </div>
<div class="line">    float TexIndex : TEX_ARRAY_INDEX;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct VSInput</div>
<div class="line">{</div>
<div class="line">    // ...</div>
<div class="line">    float  TexArrInd : ATTRIB6;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  VSInput VSIn</div>
<div class="line">          out PSInput PSIn) </div>
<div class="line">{</div>
<div class="line">    // ...</div>
<div class="line">    PSIn.TexIndex = VSIn.TexArrInd;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Pixel shader declares <code>Texture2DArray</code> variable <code>g_Texture</code> and uses the index passed from the vertex shader to select the slice. When sampling a texture array, 3-component vector is used as the texture coordinate, where the third component defines the slice.</p>
<div class="fragment"><div class="line">Texture2DArray g_Texture;</div>
<div class="line">SamplerState   g_Texture_sampler;</div>
<div class="line"> </div>
<div class="line">struct PSInput </div>
<div class="line">{ </div>
<div class="line">    float4 Pos      : SV_POSITION; </div>
<div class="line">    float2 UV       : TEX_COORD; </div>
<div class="line">    float  TexIndex : TEX_ARRAY_INDEX;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct PSOutput</div>
<div class="line">{</div>
<div class="line">    float4 Color : SV_TARGET;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  PSInput  PSIn,</div>
<div class="line">          out PSOutput PSOut)</div>
<div class="line">{</div>
<div class="line">    PSOut.Color = g_Texture.Sample(g_Texture_sampler, float3(PSIn.UV, PSIn.TexIndex)); </div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md305"></a>
Initializing the Pipeline State</h2>
<p>Pipeline state is initialized in the same way as in Tutorial04. The only difference is that the vertex layout defines one additional per-instance attribute, texture array index:</p>
<div class="fragment"><div class="line">LayoutElement LayoutElems[] =</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">    <span class="comment">// Attribute 6 - texture array index</span></div>
<div class="line">    LayoutElement{6, 1, 1, VT_FLOAT32, False, LAYOUT_ELEMENT_AUTO_OFFSET, LAYOUT_ELEMENT_AUTO_STRIDE, INPUT_ELEMENT_FREQUENCY_PER_INSTANCE},</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md306"></a>
Loading Texture Array</h2>
<p>Texture loading library does not provide a function that loads texture array. Instead, we load each individual texture and then prepare texture initialization data for all slices.</p>
<div class="fragment"><div class="line">std::vector&lt;RefCntAutoPtr&lt;ITextureLoader&gt;&gt; TexLoaders(NumTextures);</div>
<div class="line"><span class="comment">// Load textures</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> tex = 0; tex &lt; NumTextures; ++tex)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Create loader for the current texture</span></div>
<div class="line">    std::stringstream FileNameSS;</div>
<div class="line">    FileNameSS &lt;&lt; <span class="stringliteral">&quot;DGLogo&quot;</span> &lt;&lt; tex &lt;&lt; <span class="stringliteral">&quot;.png&quot;</span>;</div>
<div class="line">    <span class="keyword">const</span> std::string FileName = FileNameSS.str();</div>
<div class="line">    TextureLoadInfo LoadInfo;</div>
<div class="line">    LoadInfo.<a class="code hl_variable" href="../../df/dc7/structDiligent_1_1TextureLoadInfo.html#ac08abb66a01cbe300c22ea6daf1b5425">IsSRGB</a> = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    CreateTextureLoaderFromFile(FileName.c_str(), IMAGE_FILE_FORMAT_UNKNOWN, LoadInfo, &amp;TexLoaders[tex]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">TextureDesc TexArrDesc = TexLoaders[0]-&gt;GetTextureDesc();</div>
<div class="line">TexArrDesc.<a class="code hl_variable" href="../../d1/d76/structDiligent_1_1TextureDesc.html#a9f1c03e9ab8af4d281c389e722f71931">ArraySize</a>   = NumTextures;</div>
<div class="line">TexArrDesc.Type        = RESOURCE_DIM_TEX_2D_ARRAY;</div>
<div class="line">TexArrDesc.Usage       = USAGE_DEFAULT;</div>
<div class="line">TexArrDesc.BindFlags   = BIND_SHADER_RESOURCE;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Prepare initialization data</span></div>
<div class="line">std::vector&lt;TextureSubResData&gt; SubresData(TexArrDesc.ArraySize * TexArrDesc.MipLevels);</div>
<div class="line"><span class="keywordflow">for</span> (Uint32 slice = 0; slice &lt; TexArrDesc.ArraySize; ++slice)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (Uint32 mip = 0; mip &lt; TexArrDesc.MipLevels; ++mip)</div>
<div class="line">    {</div>
<div class="line">        SubresData[slice * TexArrDesc.MipLevels + mip] = TexLoaders[slice]-&gt;GetSubresourceData(mip, 0);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">TextureData InitData{SubresData.data(), TexArrDesc.MipLevels * TexArrDesc.ArraySize};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the texture array</span></div>
<div class="line">RefCntAutoPtr&lt;ITexture&gt; pTexArray;</div>
<div class="line">m_pDevice-&gt;CreateTexture(TexArrDesc, &amp;InitData, &amp;pTexArray);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get shader resource view from the texture array</span></div>
<div class="line">m_TextureSRV = pTexArray-&gt;GetDefaultView(TEXTURE_VIEW_SHADER_RESOURCE);</div>
<div class="ttc" id="astructDiligent_1_1TextureDesc_html_a9f1c03e9ab8af4d281c389e722f71931"><div class="ttname"><a href="../../d1/d76/structDiligent_1_1TextureDesc.html#a9f1c03e9ab8af4d281c389e722f71931">Diligent::TextureDesc::ArraySize</a></div><div class="ttdeci">Uint32 ArraySize</div><div class="ttdoc">For a 1D array or 2D array, number of array slices.</div><div class="ttdef"><b>Definition</b> Texture.h:98</div></div>
<div class="ttc" id="astructDiligent_1_1TextureLoadInfo_html_ac08abb66a01cbe300c22ea6daf1b5425"><div class="ttname"><a href="../../df/dc7/structDiligent_1_1TextureLoadInfo.html#ac08abb66a01cbe300c22ea6daf1b5425">Diligent::TextureLoadInfo::IsSRGB</a></div><div class="ttdeci">Bool IsSRGB</div><div class="ttdoc">Flag indicating if this texture uses sRGB gamma encoding.</div><div class="ttdef"><b>Definition</b> TextureLoader.h:108</div></div>
</div><!-- fragment --><p>The only last detail that is different from Tutorial04 is that <code>PopulateInstanceBuffer()</code> function computes texture array index, for every instance, and writes it to the instance buffer along with the transform matrix. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
