<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Tutorial01 - Hello Triangle</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('da/d1b/DiligentSamples_Tutorials_Tutorial01_HelloTriangle_readme.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial01 - Hello Triangle</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial demonstrates the basics of <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine API. It shows how to create shaders, pipeline state object and how to render a simple triangle.</p>
<p><img src="https://github.com/DiligentGraphics/DiligentSamples/raw/master/Tutorials/Tutorial01_HelloTriangle/Screenshot.png" alt="" class="inline"/></p>
<p><a href="https://diligentgraphics.github.io/wasm-modules/Tutorial01_HelloTriangle/Tutorial01_HelloTriangle.html">â–¶ Run in the browser</a></p>
<h2><a class="anchor" id="autotoc_md285"></a>
Shaders</h2>
<p>This tutotial uses very basic shaders. The vertex shader generates a procedural triangle. It uses an array of hard-coded vertex positions in screen space and assigns red, green and blue colors to the vertices. The shader uses system-generated vertex id as an array index.</p>
<div class="fragment"><div class="line">struct PSInput </div>
<div class="line">{ </div>
<div class="line">    float4 Pos   : SV_POSITION; </div>
<div class="line">    float3 Color : COLOR; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  uint    VertId : SV_VertexID,</div>
<div class="line">          out PSInput PSIn) </div>
<div class="line">{</div>
<div class="line">    float4 Pos[3];</div>
<div class="line">    Pos[0] = float4(-0.5, -0.5, 0.0, 1.0);</div>
<div class="line">    Pos[1] = float4( 0.0, +0.5, 0.0, 1.0);</div>
<div class="line">    Pos[2] = float4(+0.5, -0.5, 0.0, 1.0);</div>
<div class="line"> </div>
<div class="line">    float3 Col[3];</div>
<div class="line">    Col[0] = float3(1.0, 0.0, 0.0); // red</div>
<div class="line">    Col[1] = float3(0.0, 1.0, 0.0); // green</div>
<div class="line">    Col[2] = float3(0.0, 0.0, 1.0); // blue</div>
<div class="line"> </div>
<div class="line">    PSIn.Pos   = Pos[VertId];</div>
<div class="line">    PSIn.Color = Col[VertId];</div>
<div class="line">}</div>
</div><!-- fragment --><p> The shader is written in HLSL. <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine uses shader source code converter to translate HLSL into GLSL when needed. It can also use shaders authored in GLSL, but there is no GLSL to HLSL converter.</p>
<p>Pixel (fragment) shader simply interpolates vertex colors and is also written in HLSL:</p>
<div class="fragment"><div class="line">struct PSInput </div>
<div class="line">{ </div>
<div class="line">    float4 Pos   : SV_POSITION; </div>
<div class="line">    float3 Color : COLOR; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct PSOutput</div>
<div class="line">{ </div>
<div class="line">    float4 Color : SV_TARGET; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  PSInput  PSIn,</div>
<div class="line">          out PSOutput PSOut)</div>
<div class="line">{</div>
<div class="line">    PSOut.Color = float4(PSIn.Color.rgb, 1.0);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md286"></a>
Initializing the Pipeline State</h2>
<p>Pipeline state is the object that encompasses the configuration of all GPU stages. To create a pipeline state, populate <code>GraphicsPipelineStateCreateInfo</code> structure. The most important member of the structure that we will need to initialize is <code>PSODesc</code>:</p>
<div class="fragment"><div class="line">GraphicsPipelineStateCreateInfo PSOCreateInfo;</div>
</div><!-- fragment --><p>Start by giving the PSO a name. It is always a good idea to give all objects descriptive names as <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine uses these names in error reporting:</p>
<div class="fragment"><div class="line">PSOCreateInfo.PSODesc.Name = <span class="stringliteral">&quot;Simple triangle PSO&quot;</span>; </div>
</div><!-- fragment --><p>There are different types of pipeline states: graphics, compute, mesh, etc. This one is a graphics pipeline:</p>
<div class="fragment"><div class="line">PSOCreateInfo.PSODesc.PipelineType = PIPELINE_TYPE_GRAPHICS;</div>
</div><!-- fragment --><p>Next, we need to describe which outputs the pipeline state uses. This one has one output, the screen, whose format can be queried through the swap chain object:</p>
<div class="fragment"><div class="line">PSOCreateInfo.GraphicsPipeline.NumRenderTargets = 1;</div>
<div class="line">PSOCreateInfo.GraphicsPipeline.RTVFormats[0]    = pSwapChain-&gt;GetDesc().ColorBufferFormat;</div>
<div class="line">PSOCreateInfo.GraphicsPipeline.DSVFormat        = pSwapChain-&gt;GetDesc().DepthBufferFormat;</div>
</div><!-- fragment --><p>Next, we need to define what kind of primitives the pipeline can render, which are triangles in our case:</p>
<div class="fragment"><div class="line">PSOCreateInfo.GraphicsPipeline.PrimitiveTopology = PRIMITIVE_TOPOLOGY_TRIANGLE_LIST;</div>
</div><!-- fragment --><p>In this example, we do not want to worry about culling back-facing triangles, so we disable it:</p>
<div class="fragment"><div class="line">PSOCreateInfo.GraphicsPipeline.RasterizerDesc.CullMode = CULL_MODE_NONE;</div>
</div><!-- fragment --><p>This pipeline state does not use depth testing:</p>
<div class="fragment"><div class="line">PSOCreateInfo.GraphicsPipeline.DepthStencilDesc.DepthEnable = False;</div>
</div><!-- fragment --><p>The pipeline state also allows configuring several other states (rasterizer state, blend state, input layout etc.), but default values will work for now.</p>
<p>On the next step, we need to create shader objects. To create a shader, populate <code>ShaderCreateInfo</code> structure.</p>
<div class="fragment"><div class="line">ShaderCreateInfo ShaderCI;</div>
</div><!-- fragment --><p>The shaders are authored in HLSL, so we need to tell the system:</p>
<div class="fragment"><div class="line">ShaderCI.SourceLanguage = SHADER_SOURCE_LANGUAGE_HLSL;</div>
</div><!-- fragment --><p>When running in OpenGL mode, <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> converts HLSL to GLSL. Since there are no separate texture samplers in GLSL, <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> uses emulated combined samplers (g_Texture + g_Texture_sampler pair). Event though this pixel shader does not use textures, we still need to indicate we are using combined texture samplers, otherwise conversion will fail:</p>
<div class="fragment"><div class="line">ShaderCI.UseCombinedTextureSamplers = <span class="keyword">true</span>;</div>
</div><!-- fragment --><p>In this example, vertex and pixel shaders are created from the source. The code is self-explanatory:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a vertex shader</span></div>
<div class="line">RefCntAutoPtr&lt;IShader&gt; pVS;</div>
<div class="line">{</div>
<div class="line">    ShaderCI.Desc.ShaderType = SHADER_TYPE_VERTEX;</div>
<div class="line">    ShaderCI.EntryPoint      = <span class="stringliteral">&quot;main&quot;</span>;</div>
<div class="line">    ShaderCI.Desc.Name       = <span class="stringliteral">&quot;Triangle vertex shader&quot;</span>;</div>
<div class="line">    ShaderCI.Source          = VSSource;</div>
<div class="line">    pDevice-&gt;CreateShader(ShaderCI, &amp;pVS);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a pixel shader</span></div>
<div class="line">RefCntAutoPtr&lt;IShader&gt; pPS;</div>
<div class="line">{</div>
<div class="line">    ShaderCI.Desc.ShaderType = SHADER_TYPE_PIXEL;</div>
<div class="line">    ShaderCI.EntryPoint      = <span class="stringliteral">&quot;main&quot;</span>;</div>
<div class="line">    ShaderCI.Desc.Name       = <span class="stringliteral">&quot;Triangle pixel shader&quot;</span>;</div>
<div class="line">    ShaderCI.Source          = PSSource;</div>
<div class="line">    pDevice-&gt;CreateShader(ShaderCI, &amp;pPS);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, we set the shaders in the <code>PSOCreateInfo</code> and create the graphics pipeline state:</p>
<div class="fragment"><div class="line">PSOCreateInfo.pVS = pVS;</div>
<div class="line">PSOCreateInfo.pPS = pPS;</div>
<div class="line">pDevice-&gt;CreateGraphicsPipelineState(PSOCreateInfo, &amp;m_pPSO);</div>
</div><!-- fragment --><p>The pipeline state keeps references to the shader objects, so the app does not need to keep the references unless it wants to use them.</p>
<h2><a class="anchor" id="autotoc_md287"></a>
Rendering</h2>
<p>All rendering commands in <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine go through device contexts that are very similar to D3D11 device contexts. There is immediate context that directly executes commands and deferred contexts. Deferred contexts are intended to record command lists that can later be executed by the immediate context.</p>
<p>Before rendering anything on the screen we want to clear it:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">float</span> ClearColor[] = {  0.350f,  0.350f,  0.350f, 1.0f }; </div>
<div class="line">ITextureView* pRTV = m_pSwapChain-&gt;GetCurrentBackBufferRTV();</div>
<div class="line">ITextureView* pDSV = m_pSwapChain-&gt;GetDepthBufferDSV();</div>
<div class="line">m_pImmediateContext-&gt;ClearRenderTarget(pRTV, ClearColor, RESOURCE_STATE_TRANSITION_MODE_TRANSITION);</div>
<div class="line">m_pImmediateContext-&gt;ClearDepthStencil(pDSV, CLEAR_DEPTH_FLAG, 1.f, 0,</div>
<div class="line">                                       RESOURCE_STATE_TRANSITION_MODE_TRANSITION);</div>
</div><!-- fragment --><p>Clearing the depth buffer is not really necessary, but we will keep it here for consistency. Using <code>RESOURCE_STATE_TRANSITION_MODE_TRANSITION</code> flag tells the engine to perform required state transitions.</p>
<p>Next, we need to set our pipeline state in the immediate device context:</p>
<div class="fragment"><div class="line">m_pImmediateContext-&gt;SetPipelineState(m_pPSO);</div>
</div><!-- fragment --><p>Typically after setting the pipeline state we should call <code>CommitShaderResources()</code>, however shaders in this example don't use any resources.</p>
<p>Finally, we invoke the draw command that renders our 3 vertices:</p>
<div class="fragment"><div class="line">DrawAttribs drawAttrs;</div>
<div class="line">drawAttrs.<a class="code hl_variable" href="../../d6/dd0/structDiligent_1_1DrawAttribs.html#aac1a1696f8dbbbcc612ad6747ceb48de">NumVertices</a> = 3;</div>
<div class="line">m_pImmediateContext-&gt;Draw(drawAttrs);</div>
<div class="ttc" id="astructDiligent_1_1DrawAttribs_html_aac1a1696f8dbbbcc612ad6747ceb48de"><div class="ttname"><a href="../../d6/dd0/structDiligent_1_1DrawAttribs.html#aac1a1696f8dbbbcc612ad6747ceb48de">Diligent::DrawAttribs::NumVertices</a></div><div class="ttdeci">Uint32 NumVertices</div><div class="ttdoc">The number of vertices to draw.</div><div class="ttdef"><b>Definition</b> DeviceContext.h:262</div></div>
</div><!-- fragment --><p>And that's it! </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
