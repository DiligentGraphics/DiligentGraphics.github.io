<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Tutorial03 - Texturing</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d5/d74/DiligentSamples_Tutorials_Tutorial03_Texturing_readme.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Tutorial03 - Texturing</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial extends Tutorial02 and demonstrates how to apply a texture to a 3D object. It shows how to load a texture from file, create shader resource binding object and how to sample a texture in the shader.</p>
<p><img src="https://github.com/DiligentGraphics/DiligentSamples/raw/master/Tutorials/Tutorial03_Texturing/Animation_Large.gif" alt="" class="inline"/></p>
<p><a href="https://diligentgraphics.github.io/wasm-modules/Tutorial03_Texturing/Tutorial03_Texturing.html">â–¶ Run in the browser</a></p>
<h2><a class="anchor" id="autotoc_md293"></a>
Shaders</h2>
<p>The vertex shader is very similar to the one we used in Tutorial02. The only difference is that instead of color, the shader inputs texture UV coordinates and passes them to the pixel shader:</p>
<div class="fragment"><div class="line">cbuffer Constants</div>
<div class="line">{</div>
<div class="line">    float4x4 g_WorldViewProj;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct VSInput</div>
<div class="line">{</div>
<div class="line">    float3 Pos : ATTRIB0;</div>
<div class="line">    float2 UV  : ATTRIB1;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct PSInput </div>
<div class="line">{ </div>
<div class="line">    float4 Pos : SV_POSITION; </div>
<div class="line">    float2 UV  : TEX_COORD; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  VSInput VSIn,</div>
<div class="line">          out PSInput PSIn) </div>
<div class="line">{</div>
<div class="line">    PSIn.Pos = mul( float4(VSIn.Pos,1.0), g_WorldViewProj);</div>
<div class="line">    PSIn.UV  = VSIn.UV;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Pixel shader defines a 2D texture named <code>g_Texture</code> and a texture sampler named <code>g_Texture_sampler</code>. It samples the texture using UV coordinates from the vertex shader and writes the resulting color to the render target:</p>
<div class="fragment"><div class="line">Texture2D    g_Texture;</div>
<div class="line">SamplerState g_Texture_sampler;</div>
<div class="line"> </div>
<div class="line">struct PSInput </div>
<div class="line">{ </div>
<div class="line">    float4 Pos : SV_POSITION; </div>
<div class="line">    float2 UV : TEX_COORD; </div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">struct PSOutput</div>
<div class="line">{</div>
<div class="line">    float4 Color : SV_TARGET;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">void main(in  PSInput  PSIn,</div>
<div class="line">          out PSOutput PSOut)</div>
<div class="line">{</div>
<div class="line">    PSOut.Color = g_Texture.Sample(g_Texture_sampler, PSIn.UV); </div>
<div class="line">}</div>
</div><!-- fragment --><p><a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine attaches samplers to shader resource views. In the shader, <b>the sampler that is used to sample a texture must be named <code>&lt;Texture Name&gt;_sampler</code></b>, otherwise the engine will fail to properly set the sampler. This limitation is necessary to translate HLSL shaders to GLSL.</p>
<h2><a class="anchor" id="autotoc_md294"></a>
Initializing the Pipeline State</h2>
<p>This time our pixel shader uses a resource that needs to be set by the application - a texture variable <code>g_Texture</code>, so when creating the pipeline state, we need to define the resource layout. For this example, we want <code>g_Texture</code> to be a mutable resource variable:</p>
<div class="fragment"><div class="line">ShaderResourceVariableDesc Vars[] = </div>
<div class="line">{</div>
<div class="line">    {SHADER_TYPE_PIXEL, <span class="stringliteral">&quot;g_Texture&quot;</span>, SHADER_RESOURCE_VARIABLE_TYPE_MUTABLE}</div>
<div class="line">};</div>
<div class="line">PSOCreateInfo.PSODesc.ResourceLayout.Variables    = Vars;</div>
<div class="line">PSOCreateInfo.PSODesc.ResourceLayout.NumVariables = _countof(Vars);</div>
</div><!-- fragment --><p>Mutable resources are set through the object called <em>shader resource binding</em>, or SRB. SRB encompasses all resources specific to an object instance. As an example, if your character shader uses a shadow map, diffuse and normal maps, then shadow map should typically be static resource as it is the same for all object instances, while normal and diffuse maps should be mutable as they are character-specific. Shader variable type is defined by <code>ShaderResourceVariableDesc</code> structure. Recall that if shader variable type is not specified, default type defined by <code>DefaultVariableType</code> is used.</p>
<p>As it was mentioned earlier, a sampler can be attached to a texture view at run time. However, in most cases samplers do not change dynamically and it is known beforehand what kind of sampling is required. <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine uses <em>immutable samplers</em> that can be specified when creating a PSO:</p>
<div class="fragment"><div class="line">SamplerDesc SamLinearClampDesc</div>
<div class="line">{</div>
<div class="line">    FILTER_TYPE_LINEAR, FILTER_TYPE_LINEAR, FILTER_TYPE_LINEAR, </div>
<div class="line">    TEXTURE_ADDRESS_CLAMP, TEXTURE_ADDRESS_CLAMP, TEXTURE_ADDRESS_CLAMP</div>
<div class="line">};</div>
<div class="line">ImmutableSamplerDesc ImtblSamplers[] = </div>
<div class="line">{</div>
<div class="line">    {SHADER_TYPE_PIXEL, <span class="stringliteral">&quot;g_Texture&quot;</span>, SamLinearClampDesc}</div>
<div class="line">};</div>
<div class="line">PSOCreateInfo.PSODesc.ResourceLayout.ImmutableSamplers    = ImtblSamplers;</div>
<div class="line">PSOCreateInfo.PSODesc.ResourceLayout.NumImmutableSamplers = _countof(ImtblSamplers);</div>
</div><!-- fragment --><p>If an immutable sampler is defined for a texture, the sampler set in the shader resource view is ignored. Immutable samplers are preferred from performance point of view and should be used whenever possible.</p>
<h2><a class="anchor" id="autotoc_md295"></a>
Loading a texture</h2>
<p><a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine provides cross-platform texture loading library that supports jpg, png, tiff and dds formats. Loading a texture with this library requires just a few lines of code:</p>
<div class="fragment"><div class="line">TextureLoadInfo loadInfo;</div>
<div class="line">loadInfo.<a class="code hl_variable" href="../../df/dc7/structDiligent_1_1TextureLoadInfo.html#ac08abb66a01cbe300c22ea6daf1b5425">IsSRGB</a> = <span class="keyword">true</span>;</div>
<div class="line">RefCntAutoPtr&lt;ITexture&gt; Tex;</div>
<div class="line">CreateTextureFromFile(<span class="stringliteral">&quot;DGLogo.png&quot;</span>, loadInfo, m_pDevice, &amp;Tex);</div>
<div class="ttc" id="astructDiligent_1_1TextureLoadInfo_html_ac08abb66a01cbe300c22ea6daf1b5425"><div class="ttname"><a href="../../df/dc7/structDiligent_1_1TextureLoadInfo.html#ac08abb66a01cbe300c22ea6daf1b5425">Diligent::TextureLoadInfo::IsSRGB</a></div><div class="ttdeci">Bool IsSRGB</div><div class="ttdoc">Flag indicating if this texture uses sRGB gamma encoding.</div><div class="ttdef"><b>Definition</b> TextureLoader.h:108</div></div>
</div><!-- fragment --><p>To bound a texture to a shader resource variable, we need to use the texture's shader resource view (SRV). Default SRV addresses the entire texture:</p>
<div class="fragment"><div class="line"><span class="comment">// Get shader resource view from the texture</span></div>
<div class="line">m_TextureSRV = Tex-&gt;GetDefaultView(TEXTURE_VIEW_SHADER_RESOURCE);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md296"></a>
Shader Resource Binding</h2>
<p>Shader resource binding object is created by the pipeline state:</p>
<div class="fragment"><div class="line">m_pPSO-&gt;CreateShaderResourceBinding(&amp;m_SRB, <span class="keyword">true</span>);</div>
</div><!-- fragment --><p>The second parameter of <code>CreateShaderResourceBinding()</code> tellse the engine to automatically initialize all static resource variables in the SRB by copying bindings from the pipeline state.</p>
<p>Once SRB is created, we can set the shader resource view:</p>
<div class="fragment"><div class="line">m_SRB-&gt;GetVariableByName(SHADER_TYPE_PIXEL, <span class="stringliteral">&quot;g_Texture&quot;</span>)-&gt;Set(m_TextureSRV);</div>
</div><!-- fragment --><p>A mutable resource can only be bound once to an SRB object. If multiple variations are required, a number of SRB objects should be created. For a very frequently changning resources, dynamic variables can be used. Dynamic resources can be bound multiple times to the same SRB object, but are less efficient from performance point of view. Refer to <a href="http://diligentgraphics.com/2016/03/23/resource-binding-model-in-diligent-engine-2-0/">this post</a> for more details. Do not confuse shader variable type with resource usage. Shader variable type is all about binding resources to shader variables. It has nothing to do with the ability to change the resource contents which is controlled by the resource usage.</p>
<h2><a class="anchor" id="autotoc_md297"></a>
Vertex and Index Buffers</h2>
<p>Initializing vertex and index buffers is very similar to that of Tutorial02. The only difference is that cube vertices cannot be shared between faces as texture UV coordinates need to be different.</p>
<h1><a class="anchor" id="autotoc_md298"></a>
Rendering</h1>
<p>Render function is also very similar to that of Tutorial02. This time however we have an SRB object that encompasses resources to be committed:</p>
<div class="fragment"><div class="line">m_pImmediateContext-&gt;SetPipelineState(m_pPSO);</div>
<div class="line">m_pImmediateContext-&gt;CommitShaderResources(m_SRB, RESOURCE_STATE_TRANSITION_MODE_TRANSITION);</div>
</div><!-- fragment --><p>Using shader resource binding object allows to efficiently commit all resources required by all shaders in the pipeline state. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
