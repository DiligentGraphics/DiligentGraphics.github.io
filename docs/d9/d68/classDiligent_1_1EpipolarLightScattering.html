<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Diligent::EpipolarLightScattering Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d9/d68/classDiligent_1_1EpipolarLightScattering.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../d0/dec/classDiligent_1_1EpipolarLightScattering-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Diligent::EpipolarLightScattering Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements the <a href="https://github.com/DiligentGraphics/DiligentFX/tree/master/PostProcess/EpipolarLightScattering">epipolar light scattering post-process effect</a>.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;EpipolarLightScattering.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d53/structDiligent_1_1EpipolarLightScattering_1_1CreateInfo.html">CreateInfo</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create info.  <a href="../../dc/d53/structDiligent_1_1EpipolarLightScattering_1_1CreateInfo.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frame attributes that are passed to the effect at the beginning of each frame.  <a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aea8ae0fdd5b8ba2ada09514f447be34d" id="r_aea8ae0fdd5b8ba2ada09514f447be34d"><td class="memItemLeft" align="right" valign="top"><a id="aea8ae0fdd5b8ba2ada09514f447be34d" name="aea8ae0fdd5b8ba2ada09514f447be34d"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>EpipolarLightScattering</b> (const <a class="el" href="../../dc/d53/structDiligent_1_1EpipolarLightScattering_1_1CreateInfo.html">CreateInfo</a> &amp;CI)</td></tr>
<tr class="memdesc:aea8ae0fdd5b8ba2ada09514f447be34d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new instance of the <a class="el" href="../../d9/d68/classDiligent_1_1EpipolarLightScattering.html" title="Implements the epipolar light scattering post-process effect.">EpipolarLightScattering</a> class. <br /></td></tr>
<tr class="separator:aea8ae0fdd5b8ba2ada09514f447be34d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5de170ceed5100b9158cede09a6618f" id="r_ac5de170ceed5100b9158cede09a6618f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac5de170ceed5100b9158cede09a6618f">PrepareForNewFrame</a> (<a class="el" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a> &amp;<a class="el" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>, EpipolarLightScatteringAttribs &amp;PPAttribs)</td></tr>
<tr class="separator:ac5de170ceed5100b9158cede09a6618f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21e9d379463831a9d25c44ba1fff9a80" id="r_a21e9d379463831a9d25c44ba1fff9a80"><td class="memItemLeft" align="right" valign="top"><a id="a21e9d379463831a9d25c44ba1fff9a80" name="a21e9d379463831a9d25c44ba1fff9a80"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>ComputeSunColor</b> (const float3 &amp;vDirectionOnSun, const float4 &amp;f4ExtraterrestrialSunColor, float4 &amp;f4SunColorAtGround, float4 &amp;f4AmbientLight)</td></tr>
<tr class="memdesc:a21e9d379463831a9d25c44ba1fff9a80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the sun color and ambient light color based on the given direction on the sun and extraterrestrial sun color. <br /></td></tr>
<tr class="separator:a21e9d379463831a9d25c44ba1fff9a80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d88a7a5ec96cbfd4ee287863b0fcf18" id="r_a8d88a7a5ec96cbfd4ee287863b0fcf18"><td class="memItemLeft" align="right" valign="top"><a id="a8d88a7a5ec96cbfd4ee287863b0fcf18" name="a8d88a7a5ec96cbfd4ee287863b0fcf18"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>RenderSun</b> (<a class="el" href="../../d7/dca/namespaceDiligent.html#afb09d7198220b667023b6d0858abf24e">TEXTURE_FORMAT</a> RTVFormat, <a class="el" href="../../d7/dca/namespaceDiligent.html#afb09d7198220b667023b6d0858abf24e">TEXTURE_FORMAT</a> DSVFormat, <a class="el" href="../../d7/dca/namespaceDiligent.html#a3392c10112f826c3bcc60366e0f533db">Uint8</a> SampleCount)</td></tr>
<tr class="memdesc:a8d88a7a5ec96cbfd4ee287863b0fcf18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Renders the sun. <br /></td></tr>
<tr class="separator:a8d88a7a5ec96cbfd4ee287863b0fcf18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf7046b2dc88b6502411d6540744a79b" id="r_abf7046b2dc88b6502411d6540744a79b"><td class="memItemLeft" align="right" valign="top"><a id="abf7046b2dc88b6502411d6540744a79b" name="abf7046b2dc88b6502411d6540744a79b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>PerformPostProcessing</b> ()</td></tr>
<tr class="memdesc:abf7046b2dc88b6502411d6540744a79b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the post-processing effect. <br /></td></tr>
<tr class="separator:abf7046b2dc88b6502411d6540744a79b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50b56c8f6cec950ba64fe992dcbcb9c8" id="r_a50b56c8f6cec950ba64fe992dcbcb9c8"><td class="memItemLeft" align="right" valign="top"><a id="a50b56c8f6cec950ba64fe992dcbcb9c8" name="a50b56c8f6cec950ba64fe992dcbcb9c8"></a>
<a class="el" href="../../d9/d7b/structDiligent_1_1IBuffer.html">IBuffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>GetMediaAttribsCB</b> ()</td></tr>
<tr class="memdesc:a50b56c8f6cec950ba64fe992dcbcb9c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the media attributes buffer. <br /></td></tr>
<tr class="separator:a50b56c8f6cec950ba64fe992dcbcb9c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af057be31e55840361212b697eb79adc6" id="r_af057be31e55840361212b697eb79adc6"><td class="memItemLeft" align="right" valign="top"><a id="af057be31e55840361212b697eb79adc6" name="af057be31e55840361212b697eb79adc6"></a>
<a class="el" href="../../dc/d24/structDiligent_1_1ITextureView.html">ITextureView</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>GetPrecomputedNetDensitySRV</b> ()</td></tr>
<tr class="memdesc:af057be31e55840361212b697eb79adc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the precomputed net density look-up texture. <br /></td></tr>
<tr class="separator:af057be31e55840361212b697eb79adc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4176178213e12fdd8bc01f72d267597" id="r_ab4176178213e12fdd8bc01f72d267597"><td class="memItemLeft" align="right" valign="top"><a id="ab4176178213e12fdd8bc01f72d267597" name="ab4176178213e12fdd8bc01f72d267597"></a>
<a class="el" href="../../dc/d24/structDiligent_1_1ITextureView.html">ITextureView</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>GetAmbientSkyLightSRV</b> (<a class="el" href="../../de/dc2/classDiligent_1_1IRenderDevice.html">IRenderDevice</a> *pDevice, <a class="el" href="../../d3/d09/structDiligent_1_1IRenderStateCache.html">IRenderStateCache</a> *pStateCache, <a class="el" href="../../d9/dcf/classDiligent_1_1IDeviceContext.html">IDeviceContext</a> *pContext)</td></tr>
<tr class="memdesc:ab4176178213e12fdd8bc01f72d267597"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the ambient sky light texture. <br /></td></tr>
<tr class="separator:ab4176178213e12fdd8bc01f72d267597"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements the <a href="https://github.com/DiligentGraphics/DiligentFX/tree/master/PostProcess/EpipolarLightScattering">epipolar light scattering post-process effect</a>. </p>
<h1><a class="anchor" id="autotoc_md152"></a>
EpipolarLightScattering</h1>
<p><img src="../../media/LightScattering.png" alt="" class="inline"/></p>
<p>This post-processing effect renders realistic high-quality light scattering effects and is based on this <a href="https://github.com/GameTechDev/OutdoorLightScattering">sample from Intel</a>. The effect works by smartly placing expensive ray-marching samples along the epipolar lines that start at the light source and interpolating the radiance between these samples.</p>
<p><img src="../../media/EpipolarSampling.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md153"></a>
Parameters</h2>
<p><code>EpipolarLightScatteringAttribs</code> structure The following parameters control the effect</p>
<ul>
<li><code>uiNumEpipolarSlices</code> - the total number of epipolar slices (lines). For high quality effect, set this value to (Screen Width + Screen Height)/2</li>
<li><code>uiMaxSamplesInSlice</code> - Maximum number of samples on a single epipolar line. When epipolar light is short, the actual number of samples may be lower. For high quality effect, set this value to max(Screen Width, Screen Height)/2.</li>
<li><code>uiInitialSampleStepInSlice</code> - Initial ray marching sample spacing on an epipolar line. Additional samples are added at discontinuities.</li>
<li><code>uiEpipoleSamplingDensityFactor</code> - Sample density scale near the epipole where inscattering changes rapidly. Note that sampling near the epipole is very cheap since only a few steps required to perform ray marching.</li>
<li><code>fRefinementThreshold</code> - Sampling refinement threshold that controls detection of discontinuities. Smaller values produce more samples and higher quality, but at a higher performance cost.</li>
<li><code>bShowSampling</code> - Whether to show epipolar sampling.</li>
<li><code>bCorrectScatteringAtDepthBreaks</code> - Whether to correct inscattering at depth discontinuities. Improves quality for additional cost. It may be preferable to increase the number of slices and or maximum number of samples on an epipolar line instead.</li>
<li><code>bShowDepthBreaks</code> - Whether to display pixels which are classified as depth discontinuities and which will be corrected. Only has effect when bCorrectScatteringAtDepthBreaks is TRUE.</li>
<li><code>bShowLightingOnly</code> - Whether to show lighting only</li>
<li><code>bOptimizeSampleLocations</code> - Optimize sample locations to avoid oversampling. This should generally be TRUE.</li>
<li><code>bEnableLightShafts</code> - Whether to enable light shafts or render unshadowed inscattering. Setting this to FALSE increases performance, but reduces visual quality.</li>
<li><code>uiInstrIntegralSteps</code> - Number of inscattering integral steps taken when computing unshadowed inscattering Default value is OK and should not be changed.</li>
<li><code>f2ShadowMapTexelSize</code> - Size of the shadowmap texel (1/width, 1/height)</li>
<li><code>uiMaxSamplesOnTheRay</code> - Maximum number of ray marching samples on a single ray. Typically this value should match the maximum shadow map cascade resolution. Using lower value will improve performance but may result in moire patterns. Note that in most cases significantly less samples are actually taken.</li>
<li><code>uiMinMaxShadowMapResolution</code> - Defines the number of samples at the lowest level of min-max binary tree and should match the maximum cascade shadow map resolution.</li>
<li><code>iNumCascades</code> - Number of shadow map cascades</li>
<li><code>iFirstCascadeToRayMarch</code> - First cascade to use for ray marching. Usually first few cascades are small, and ray marching them is inefficient.</li>
<li><code>fMaxShadowMapStep</code> - Cap on the maximum shadow map step in texels.</li>
<li><code>bUse1DMinMaxTree</code> - Whether to use 1D min/max binary tree optimization. This improves performance for higher shadow map resolution. Test it.</li>
<li><code>bIs32BitMinMaxMipMap</code> - Whether to use 32-bit float or 16-bit UNORM min-max binary tree. Usually 16-bit UNORM is OK.</li>
<li><code>uiLightSctrTechnique</code> - Light scattering evaluation technique. The following two methods are available: epipolar and brute-force. Brute force light scattering performs expensive ray marching for every screen pixel. This method can be used as the quality reference.</li>
<li><code>uiCascadeProcessingMode</code> - Shadow map cascades processing mode.</li>
<li><code>uiRefinementCriterion</code> - Epipolar sampling refinement criterion. The two options are depth difference and scattering difference. Scattering difference is generally preferable way.</li>
<li><code>uiSingleScatteringMode</code> - Single scattering evaluation mode. The following three methods are available:<ul>
<li>None - no single scattering.</li>
<li>Integration (default) - evaluate single scattering with numerical integration.</li>
<li>Look-up table - use precomputed single-scattering look-up table.</li>
</ul>
</li>
<li><code>uiMultipleScatteringMode</code> - Higher-order scattering evaluation mode. The following three options are available:<ul>
<li>None - no multiple scattering.</li>
<li>Unoccluded (default) - evaluate multiple scattering without shadowing.</li>
<li>Occluded - evaluate multiple scattering taking shadowing into account similar to single scattering.</li>
</ul>
</li>
<li><code>uiExtinctionEvalMode</code> - Atmospheric extinction evaluation mode.</li>
<li><code>bUseCustomSctrCoeffs</code> - Whether to use custom scattering coefficients.</li>
<li><code>fAerosolDensityScale</code> - Aerosol density scale to use for scattering coefficient computation.</li>
<li><code>fAerosolAbsorbtionScale</code> - Aerosol absorption scale to use for scattering coefficient computation.</li>
<li><code>f4CustomRlghBeta</code> - Custom Rayleigh coefficients.</li>
<li><code>f4CustomMieBeta</code> - Custom Mie coefficients.</li>
</ul>
<h2><a class="anchor" id="autotoc_md154"></a>
Integration</h2>
<p>The effect requires the following data:</p><ul>
<li>Shader and render target views of the original color buffer</li>
<li>Shader and depth-stencil views of the original depth buffer</li>
<li>Shadow map</li>
<li>Light and color attributes</li>
</ul>
<p>The code snippet below shows how to use the epipolar light scattering post-processing effect. For the full source code, see <a href="https://github.com/DiligentGraphics/DiligentSamples/tree/master/Samples/Atmosphere">Atmospheric scattering sample</a>.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">EpipolarLightScattering::FrameAttribs</a> <a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#af4bfaff46b380123f10d4d5581241cf5">pDevice</a>        = m_pDevice;</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#ae4614d1a44c824c4e55a7f1d1e1fe84a">pDeviceContext</a> = m_pImmediateContext;</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a2019d0e0915ade37c26e716a525c7d67">dElapsedTime</a>   = m_fElapsedTime;</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a3d40ccf9d51d48568b5c209767532534">pLightAttribs</a>  = &amp;LightAttrs;</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a0823181503a48d943640a506fc8b25d2">pCameraAttribs</a> = &amp;CamAttribs;</div>
<div class="line"> </div>
<div class="line">m_PPAttribs.iNumCascades = m_TerrainRenderParams.m_iNumShadowCascades;</div>
<div class="line">m_PPAttribs.fNumCascades = (float)m_TerrainRenderParams.m_iNumShadowCascades;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a6be9521c8c4f65c82fcabf01af459622">pcbLightAttribs</a>  = m_pcbLightAttribs;</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a9df1233c5c1fb6d248cf4865cd599fb0">pcbCameraAttribs</a> = m_pcbCameraAttribs;</div>
<div class="line"> </div>
<div class="line">m_PPAttribs.fMaxShadowMapStep = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(m_uiShadowMapResolution / 4);</div>
<div class="line">        </div>
<div class="line">m_PPAttribs.f2ShadowMapTexelSize = float2( 1.f / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(m_uiShadowMapResolution), 1.f / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(m_uiShadowMapResolution) );</div>
<div class="line">m_PPAttribs.uiMaxSamplesOnTheRay = m_uiShadowMapResolution;</div>
<div class="line"><span class="comment">// During the ray marching, on each step we move by the texel size in either horz </span></div>
<div class="line"><span class="comment">// or vert direction. So resolution of min/max mipmap should be the same as the </span></div>
<div class="line"><span class="comment">// resolution of the original shadow map</span></div>
<div class="line">m_PPAttribs.uiMinMaxShadowMapResolution    = m_uiShadowMapResolution;</div>
<div class="line">m_PPAttribs.uiInitialSampleStepInSlice     = std::min( m_PPAttribs.uiInitialSampleStepInSlice, m_PPAttribs.uiMaxSamplesInSlice );</div>
<div class="line">m_PPAttribs.uiEpipoleSamplingDensityFactor = std::min( m_PPAttribs.uiEpipoleSamplingDensityFactor, m_PPAttribs.uiInitialSampleStepInSlice );</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a64bae3085377a5f20036935aeca64e64">ptex2DSrcColorBufferSRV</a> = m_pOffscreenColorBuffer-&gt;GetDefaultView(<a class="code hl_enumvalue" href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68acd9fed7b22b88f0a8b40d0d98d3c1243">TEXTURE_VIEW_SHADER_RESOURCE</a>);</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.ptex2DSrcColorBufferRTV = m_pOffscreenColorBuffer-&gt;GetDefaultView(<a class="code hl_enumvalue" href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68ae7e090499e01b1aa0e57e7d71c9e7d22">TEXTURE_VIEW_RENDER_TARGET</a>);</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a8be3b65d44124ef07931732c6a57e03a">ptex2DSrcDepthBufferSRV</a> = m_pOffscreenDepthBuffer-&gt;GetDefaultView(<a class="code hl_enumvalue" href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68acd9fed7b22b88f0a8b40d0d98d3c1243">TEXTURE_VIEW_SHADER_RESOURCE</a>);</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.ptex2DSrcDepthBufferDSV = m_pOffscreenDepthBuffer-&gt;GetDefaultView(<a class="code hl_enumvalue" href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68af974362f40fbd2a6062e8220124a86aa">TEXTURE_VIEW_DEPTH_STENCIL</a>);</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.<a class="code hl_variable" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a80c783fdaddeb08e9cc7dbd121ca695d">ptex2DShadowMapSRV</a>      = m_pShadowMapSRV;</div>
<div class="line"><a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>.pDstRTV                 = <span class="keyword">nullptr</span>;<span class="comment">// mpBackBufferRTV;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform the post processing</span></div>
<div class="line">m_pLightSctrPP-&gt;PerformPostProcessing(<a class="code hl_struct" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a>, m_PPAttribs);</div>
<div class="ttc" id="anamespaceDiligent_html_a6863a150530d5abe1cc5627b23ebce68acd9fed7b22b88f0a8b40d0d98d3c1243"><div class="ttname"><a href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68acd9fed7b22b88f0a8b40d0d98d3c1243">Diligent::TEXTURE_VIEW_SHADER_RESOURCE</a></div><div class="ttdeci">@ TEXTURE_VIEW_SHADER_RESOURCE</div><div class="ttdef"><b>Definition</b> GraphicsTypes.h:327</div></div>
<div class="ttc" id="anamespaceDiligent_html_a6863a150530d5abe1cc5627b23ebce68ae7e090499e01b1aa0e57e7d71c9e7d22"><div class="ttname"><a href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68ae7e090499e01b1aa0e57e7d71c9e7d22">Diligent::TEXTURE_VIEW_RENDER_TARGET</a></div><div class="ttdeci">@ TEXTURE_VIEW_RENDER_TARGET</div><div class="ttdef"><b>Definition</b> GraphicsTypes.h:331</div></div>
<div class="ttc" id="anamespaceDiligent_html_a6863a150530d5abe1cc5627b23ebce68af974362f40fbd2a6062e8220124a86aa"><div class="ttname"><a href="../../d7/dca/namespaceDiligent.html#a6863a150530d5abe1cc5627b23ebce68af974362f40fbd2a6062e8220124a86aa">Diligent::TEXTURE_VIEW_DEPTH_STENCIL</a></div><div class="ttdeci">@ TEXTURE_VIEW_DEPTH_STENCIL</div><div class="ttdef"><b>Definition</b> GraphicsTypes.h:335</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">Diligent::EpipolarLightScattering::FrameAttribs</a></div><div class="ttdoc">Frame attributes that are passed to the effect at the beginning of each frame.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:180</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a0823181503a48d943640a506fc8b25d2"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a0823181503a48d943640a506fc8b25d2">Diligent::EpipolarLightScattering::FrameAttribs::pCameraAttribs</a></div><div class="ttdeci">const CameraAttribs * pCameraAttribs</div><div class="ttdoc">A pointer to the camera attributes CPU data.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:197</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a2019d0e0915ade37c26e716a525c7d67"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a2019d0e0915ade37c26e716a525c7d67">Diligent::EpipolarLightScattering::FrameAttribs::dElapsedTime</a></div><div class="ttdeci">double dElapsedTime</div><div class="ttdoc">The time elapsed since the last frame.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:191</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a3d40ccf9d51d48568b5c209767532534"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a3d40ccf9d51d48568b5c209767532534">Diligent::EpipolarLightScattering::FrameAttribs::pLightAttribs</a></div><div class="ttdeci">const LightAttribs * pLightAttribs</div><div class="ttdoc">A pointer to the light attributes CPU data.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:194</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a64bae3085377a5f20036935aeca64e64"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a64bae3085377a5f20036935aeca64e64">Diligent::EpipolarLightScattering::FrameAttribs::ptex2DSrcColorBufferSRV</a></div><div class="ttdeci">ITextureView * ptex2DSrcColorBufferSRV</div><div class="ttdoc">Shader resource view of the source color buffer.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:206</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a6be9521c8c4f65c82fcabf01af459622"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a6be9521c8c4f65c82fcabf01af459622">Diligent::EpipolarLightScattering::FrameAttribs::pcbLightAttribs</a></div><div class="ttdeci">IBuffer * pcbLightAttribs</div><div class="ttdoc">If this parameter is null, the effect will use its own buffer.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:200</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a80c783fdaddeb08e9cc7dbd121ca695d"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a80c783fdaddeb08e9cc7dbd121ca695d">Diligent::EpipolarLightScattering::FrameAttribs::ptex2DShadowMapSRV</a></div><div class="ttdeci">ITextureView * ptex2DShadowMapSRV</div><div class="ttdoc">Shadow map shader resource view.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:218</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a8be3b65d44124ef07931732c6a57e03a"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a8be3b65d44124ef07931732c6a57e03a">Diligent::EpipolarLightScattering::FrameAttribs::ptex2DSrcDepthBufferSRV</a></div><div class="ttdeci">ITextureView * ptex2DSrcDepthBufferSRV</div><div class="ttdoc">Shader resource view of the source depth.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:209</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_a9df1233c5c1fb6d248cf4865cd599fb0"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#a9df1233c5c1fb6d248cf4865cd599fb0">Diligent::EpipolarLightScattering::FrameAttribs::pcbCameraAttribs</a></div><div class="ttdeci">IBuffer * pcbCameraAttribs</div><div class="ttdoc">If this parameter is null, the effect will use its own buffer.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:203</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_ae4614d1a44c824c4e55a7f1d1e1fe84a"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#ae4614d1a44c824c4e55a7f1d1e1fe84a">Diligent::EpipolarLightScattering::FrameAttribs::pDeviceContext</a></div><div class="ttdeci">IDeviceContext * pDeviceContext</div><div class="ttdoc">Device context that will record the rendering commands.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:188</div></div>
<div class="ttc" id="astructDiligent_1_1EpipolarLightScattering_1_1FrameAttribs_html_af4bfaff46b380123f10d4d5581241cf5"><div class="ttname"><a href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html#af4bfaff46b380123f10d4d5581241cf5">Diligent::EpipolarLightScattering::FrameAttribs::pDevice</a></div><div class="ttdeci">IRenderDevice * pDevice</div><div class="ttdoc">Render device that may be used to create new objects needed for this frame, if any.</div><div class="ttdef"><b>Definition</b> EpipolarLightScattering.hpp:182</div></div>
</div><!-- fragment -->   </div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ac5de170ceed5100b9158cede09a6618f" name="ac5de170ceed5100b9158cede09a6618f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5de170ceed5100b9158cede09a6618f">&#9670;&#160;</a></span>PrepareForNewFrame()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Diligent::EpipolarLightScattering::PrepareForNewFrame </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d2/da9/structDiligent_1_1EpipolarLightScattering_1_1FrameAttribs.html">FrameAttribs</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>FrameAttribs</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EpipolarLightScatteringAttribs &amp;</td>          <td class="paramname"><span class="paramname"><em>PPAttribs</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The method prepares internal resources and states for processing the next frame. It must be called at the beginning of every frame before any other rendering method (RenderSun, PerformPostProcessing) can be called. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d7/dca/namespaceDiligent.html">Diligent</a></li><li class="navelem"><a class="el" href="../../d9/d68/classDiligent_1_1EpipolarLightScattering.html">EpipolarLightScattering</a></li>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
