<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Coordinate System Conventions</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('d8/da4/DiligentCore_doc_CoordinateSystem.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Coordinate System Conventions</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>While there exist multiple ways to express transformations of a 3D scene (row-vectors vs column-vectors, right-handed systems vs left-handed systems, etc.), from the point of view of the graphics API the only coordinate system that matters is called Normalized Device Space (NDC). <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> Engine uses the Direct3D convention, in which NDC is a half cube [-1, +1] x [-1, +1] x [0, 1]. For the API, it is totally irrelevant which spaces the coordinates traveled through before they ended up in the NDC. In particular, if you are using the right-handed coordinate system with the camera looking towards the -Z direction, eventually the combination of transformation should bring the model into the NDC with Z in [0, 1] range.</p>
<p>The NDC naturally maps to the screen: X axis goes left to right, Y axis goes down-up, and Z axis goes into the screen. Culling mode is based on the winding direction of vertices in the NDC.</p>
<p>Note that when NDC is converted into window coordinates, the Y axis is inverted such that the first byte of the raw texture data will correspond to the location with coordinates (-1, +1) in NDC. When the texture is presented to the screen, the image is inverted again because the screen origin is in the top left corner, so the image is shown properly. When rendering to an off-screen textures, however, the image will end up upside-down.</p>
<p>The convention above is the default convention in Direct3D11 and Direct3D12. Vulkan is generally very similar, but it does not by default invert the Y axis when mapping NDC to Window coordinates. This, however, can be circumvented by using the negative viewport height, thus making Vulkan backend 100% compatible with Direct3D11 and Direct3D12.</p>
<p>OpenGL as always is a headache. First of all, at some point somebody decided that symmetry should prevail over common sense, and as a result the default NDC space in OpenGL is [-1, +1] x [-1, +1] x [-1, +1]. After a bit of web search you can easily find what disastrous consequences this has for the precision of floating point numbers when using inverse depth buffering. [0, +1] z range may be optionally enabled by setting <code>ZeroToOneNDZ</code> of <code>EngineGLCreateInfo</code> struct to true. This feature requires an extension that is not widely supported on all mobile devices, so an application should query the actual z range after creating the device.</p>
<p>The Z range in OpenGL cannot be fixed under the hood, as it needs to be baked into the projection matrix. <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a>'s projection functions take a parameter that indicates if the matrix should be constructed for OpenGL. Note that Direct3D/Vulkan projection matrices will also work in OpenGL, but will use half of the Z range (likely without any negative consequences for the majority of applications).</p>
<p>The second issue with OpenGL is that there is no way to invert Y axis when mapping NDC to window space. To alleviate this problem, <a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a>'s SetViewport method takes the size of the render target. By default these are taken from the currently bound render target. OpenGL backend uses these to adjust the viewport coordinates similar to Vulkan. This works in most cases (e.g. shadow mapping), however since the viewport height can't be negative there are few cases when it does not quite work and require special handling (e.g. off-screen rendering).</p>
<p>So the bottom line is that Direct3D-style coordinates will work in majority of the situations in all backends. In few cases (such as rendering to a texture and then showing this texture on the screen), OpenGL may require special care: you may need to invert the texture V coordinate. Other backends are always 100% consistent.</p>
<p><a class="el" href="../../d7/dca/namespaceDiligent.html" title="Graphics engine namespace.">Diligent</a> math library uses row-vectors, similar to Direct3D. Matrices should be multiplied in the order the respective transforms are applied, e.g.:</p>
<div class="fragment"><div class="line">float4x4 WorldViewProj = World * View * Proj;</div>
<div class="line">float4   PositionProj  = PositionWorld * WorldViewProj;</div>
</div><!-- fragment --><p>As it was mentioned in the beginning, applications may use any library of their preference. As long as the math produces the same coordinates in NDC, the choice of the specific library is irrelevant. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
