<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Diligent Engine: Bloom</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Diligent Engine
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(1); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('df/de0/DiligentFX_PostProcess_Bloom_README.html','../../'); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Bloom</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><img src="https://github.com/DiligentGraphics/DiligentFX/raw/master/PostProcess/Bloom/media/bloom.jpg" alt="" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md130"></a>
Table of contents</h2>
<ul>
<li>Introduction</li>
<li>Integration guidelines<ul>
<li>Input resources</li>
<li>Host API</li>
</ul>
</li>
<li>Implementation details</li>
<li><a class="el" href="../../de/d6b/README.html#references">References</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md131"></a>
Introduction</h2>
<p>Displays have a low dynamic range (LDR), limiting brightness levels to a scale from black to full brightness (RGB 0 to 1), unlike the unlimited brightness in real life. High dynamic range (HDR) technology allows for brightness levels above 1, though actual displays still limit these to their maximum LDR brightness. HDR scenes are adapted for LDR displays through tonemapping and auto-exposure, which adjust the image's brightness and contrast.</p>
<p>Bloom is an effect that simulates intense brightness by causing bright pixels to bleed into adjacent ones.</p>
<h2><a class="anchor" id="autotoc_md132"></a>
Integration guidelines</h2>
<h3><a class="anchor" id="autotoc_md133"></a>
Input resources</h3>
<p>The following table enumerates all external inputs required by Bloom effect.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Name</b>   </th><th class="markdownTableHeadNone"><b>Format</b>   </th><th class="markdownTableHeadNone"><b>Notes</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Color buffer   </td><td class="markdownTableBodyNone"><code>APPLICATION SPECIFIED (3x FLOAT)</code>   </td><td class="markdownTableBodyNone">The HDR render target of the current frame containing the scene radiance   </td></tr>
</table>
<p>The effect uses a number of parameters that control the quality and performance and are organized into the <code>HLSL::ScreenSpaceAmbientOcclusionAttribs</code> structure. The following table lists the parameters and their descriptions.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Name</b>   </th><th class="markdownTableHeadNone"><b>Notes</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Intensity</code>   </td><td class="markdownTableBodyNone">Intensity of the bloom effect.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Threshold</code>   </td><td class="markdownTableBodyNone">The minimum brightness required for a pixel to contribute to the bloom effect.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SoftTreshold</code>   </td><td class="markdownTableBodyNone">The softness of the threshold. A higher value will result in a softer threshold.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Radius</code>   </td><td class="markdownTableBodyNone">The size of the bloom effect. A larger radius will result in a larger area of the image being affected by the bloom effect.   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md134"></a>
Host API</h3>
<p>To integrate Bloom into your project, include the following header files: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;PostFXContext.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="../../df/d13/Bloom_8hpp.html">Bloom.hpp</a>&quot;</span></div>
<div class="ttc" id="aBloom_8hpp_html"><div class="ttname"><a href="../../df/d13/Bloom_8hpp.html">Bloom.hpp</a></div></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">namespace </span>HLSL</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#include &quot;Shaders/Common/public/BasicStructures.fxh&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Shaders/PostProcess/Bloom/public/BloomStructures.fxh&quot;</span></div>
<div class="line">} <span class="comment">// namespace HLSL</span></div>
</div><!-- fragment --><p>Now, create the necessary objects: </p><div class="fragment"><div class="line">m_PostFXContext = std::make_unique&lt;PostFXContext&gt;(m_pDevice);</div>
<div class="line">m_Bloom         = std::make_unique&lt;Bloom&gt;(m_pDevice);</div>
</div><!-- fragment --><p>Next, call the methods to prepare resources for the <code>PostFXContext</code> and <code>Bloom</code> objects. This needs to be done every frame before starting the rendering process. </p><div class="fragment"><div class="line">PostFXContext::FrameDesc FrameDesc;</div>
<div class="line">FrameDesc.Index  = m_CurrentFrameNumber; <span class="comment">// Current frame number.</span></div>
<div class="line">FrameDesc.Width  = SCDesc.Width;         <span class="comment">// Current screen width.</span></div>
<div class="line">FrameDesc.Height = SCDesc.Height;        <span class="comment">// Current screen height.</span></div>
<div class="line">m_PostFXContext-&gt;PrepareResources(m_pDevice, FrameDesc, PostFXContext::FEATURE_FLAG_NONE);</div>
<div class="line"> </div>
<div class="line">m_Bloom-&gt;PrepareResources(m_pDevice, m_pImmediateContext, m_PostFXContext.get(), Bloom::FEATURE_FLAG_NONE);</div>
</div><!-- fragment --><p>Next, call the <code>PostFXContext::Execute</code> method prepare intermediate resources required by all post-processing objects dependent on <code>PostFXContext</code>. This method can take a constant buffer containing the current and previous-frame cameras (refer to these code examples: [<a href="https://github.com/DiligentGraphics/DiligentSamples/raw/380b0a05b6c72d80fd6d574d7343ead77d6dd7eb/Tutorials/Tutorial27_PostProcessing/src/Tutorial27_PostProcessing.cpp#L164">0</a>] and [<a href="https://github.com/DiligentGraphics/DiligentSamples/raw/380b0a05b6c72d80fd6d574d7343ead77d6dd7eb/Tutorials/Tutorial27_PostProcessing/src/Tutorial27_PostProcessing.cpp#L228">1</a>]). Alternatively, you can pass the corresponding pointers <code>const HLSL::CameraAttribs* pCurrCamera</code> and <code>const HLSL::CameraAttribs* pPrevCamera</code> for the current and previous cameras, respectively. You also need to pass the depth of the current and previous frames, and a buffer with motion vectors in NDC space, via the corresponding <code>ITextureView* pCurrDepthBufferSRV</code>, <code>ITextureView* pPrevDepthBufferSRV</code>, and <code>ITextureView* pMotionVectorsSRV</code> pointers.</p>
<div class="fragment"><div class="line">PostFXContext::RenderAttributes PostFXAttibs;</div>
<div class="line">PostFXAttibs.pDevice             = m_pDevice;</div>
<div class="line">PostFXAttibs.pDeviceContext      = m_pImmediateContext;</div>
<div class="line">PostFXAttibs.pCameraAttribsCB    = m_FrameAttribsCB;</div>
<div class="line">m_PostFXContext-&gt;Execute(PostFXAttibs);</div>
</div><!-- fragment --><p>To calculate bloom effect, call the <code>Bloom::Execute</code> method. Before this, fill the <code>BloomAttribs</code> and <code>Bloom::RenderAttributes</code> structures with the necessary data. Refer to the Input resources section for parameter description. </p><div class="fragment"><div class="line">HLSL::BloomAttribs BloomSettings{};</div>
<div class="line"> </div>
<div class="line">Bloom::RenderAttributes BloomRenderAttribs{};</div>
<div class="line">BloomRenderAttribs.pDevice         = m_pDevice;</div>
<div class="line">BloomRenderAttribs.pDeviceContext  = m_pImmediateContext;</div>
<div class="line">BloomRenderAttribs.pPostFXContext  = m_PostFXContext.get();</div>
<div class="line">BloomRenderAttribs.pColorBufferSRV = m_ColorBuffer;</div>
<div class="line">BloomRenderAttribs.pBloomAttribs   = &amp;BloomSettings;</div>
<div class="line">m_Bloom-&gt;Execute(SSAORenderAttribs);</div>
</div><!-- fragment --><p>To obtain an <code>ITextureView</code> of the texture containing the bloom result, use the <code>Bloom::GetBloomTextureSRV</code> method.</p>
<h2><a class="anchor" id="autotoc_md135"></a>
Implementation details</h2>
<p>Our implementation is based on the technique described in <b>[Léna Piquet, 2021]</b>. We modified it by adding a threshold and using the Additive Bloom as described in <b>[Alexander Christensen, 2022]</b>. Additionally, we changed the weighting to eliminate fireflies from this article (section Bonus material 2: Karis average) as follows:</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> Weights[5];</div>
<div class="line">Weights[0] = 0.125f;</div>
<div class="line">Weights[1] = 0.125f;</div>
<div class="line">Weights[2] = 0.125f;</div>
<div class="line">Weights[3] = 0.125f;</div>
<div class="line">Weights[4] = 0.5f;</div>
<div class="line"> </div>
<div class="line">float3 Groups[5];</div>
<div class="line">Groups[0] = (A + B + D + E) / 4.0f;</div>
<div class="line">Groups[1] = (B + C + E + F) / 4.0f;</div>
<div class="line">Groups[2] = (D + E + G + H) / 4.0f;</div>
<div class="line">Groups[3] = (E + F + H + I) / 4.0f;</div>
<div class="line">Groups[4] = (J + K + L + M) / 4.0f;</div>
<div class="line">    </div>
<div class="line">float4 ColorSum = float4(0.0, 0.0, 0.0, 0.0);</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> GroupId = 0; GroupId &lt; 5; ++GroupId) {</div>
<div class="line">    <span class="keywordtype">float</span> Weight = Weights[GroupId] * KarisAverage(Groups[GroupId]);</div>
<div class="line">    ColorSum += float4(Groups[GroupId], 1.0) * Weight;</div>
<div class="line">}</div>
<div class="line">float3 ResultColor = ColorSum.xyz / ColorSum.w;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md136"></a>
References</h2>
<ul>
<li><b>[Jimenez, 2014]</b>: Next Generation Post Processing in Call of Duty: Advanced Warfare - <a href="https://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare/">https://www.iryoku.com/next-generation-post-processing-in-call-of-duty-advanced-warfare/</a></li>
<li><b>[Léna Piquet, 2021]</b>: Custom Bloom Post-Process in Unreal Engine - <a href="https://www.froyok.fr/blog/2021-12-ue4-custom-bloom/">https://www.froyok.fr/blog/2021-12-ue4-custom-bloom/</a></li>
<li><b>[Alexander Christensen, 2022]</b>: Physically Based Bloom - <a href="https://learnopengl.com/Guest-Articles/2022/Phys.-Based-Bloom/">https://learnopengl.com/Guest-Articles/2022/Phys.-Based-Bloom/</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.13.2-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <a href="https://diligentgraphics.com">
        <img class="footer" src="https://github.com/DiligentGraphics/DiligentCore/raw/master/media/diligentgraphics-logo.png" width="99" height="32" alt="Diligent Graphics" />
      </a>
    </li>
  </ul>
</div>
</body>
</html>
